<!doctype html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Java,Java Source Code,StringBuilder,StringBuffer,String," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="StringString的定义String 在Java中是非常常见的一个数据类型了，Java本身对String是一个怎么样的描述呢？我们来看其中对String的一些解释：123Strings are constant; their values cannot be changed after they are created. String buffers support mutable stri">
<meta name="keywords" content="Java,Java Source Code,StringBuilder,StringBuffer,String">
<meta property="og:type" content="article">
<meta property="og:title" content="Java常用类源码——String、StringBuffer、StringBuild源码解析">
<meta property="og:url" content="http://yoursite.com/2016/11/07/Java常用类源码——String、StringBuffer、StringBuild源码解析/index.html">
<meta property="og:site_name" content="Charse&#39;s Blog">
<meta property="og:description" content="StringString的定义String 在Java中是非常常见的一个数据类型了，Java本身对String是一个怎么样的描述呢？我们来看其中对String的一些解释：123Strings are constant; their values cannot be changed after they are created. String buffers support mutable stri">
<meta property="og:updated_time" content="2017-05-30T07:58:22.511Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java常用类源码——String、StringBuffer、StringBuild源码解析">
<meta name="twitter:description" content="StringString的定义String 在Java中是非常常见的一个数据类型了，Java本身对String是一个怎么样的描述呢？我们来看其中对String的一些解释：123Strings are constant; their values cannot be changed after they are created. String buffers support mutable stri">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2016/11/07/Java常用类源码——String、StringBuffer、StringBuild源码解析/"/>





  <title>Java常用类源码——String、StringBuffer、StringBuild源码解析 | Charse's Blog</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  















  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Charse's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/07/Java常用类源码——String、StringBuffer、StringBuild源码解析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Charse">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Charse's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Java常用类源码——String、StringBuffer、StringBuild源码解析</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-07T22:45:11+08:00">
                2016-11-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/07/Java常用类源码——String、StringBuffer、StringBuild源码解析/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/07/Java常用类源码——String、StringBuffer、StringBuild源码解析/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2016/11/07/Java常用类源码——String、StringBuffer、StringBuild源码解析/" class="leancloud_visitors" data-flag-title="Java常用类源码——String、StringBuffer、StringBuild源码解析">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="String"><a href="#String" class="headerlink" title="String"></a><strong>String</strong></h1><h2 id="String的定义"><a href="#String的定义" class="headerlink" title="String的定义"></a><strong>String的定义</strong></h2><p>String 在Java中是非常常见的一个数据类型了，Java本身对String是一个怎么样的描述呢？<br>我们来看其中对String的一些解释：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Strings are constant; their values cannot be changed after they </div><div class="line">are created. String buffers support mutable strings.</div><div class="line">Because String objects are immutable they can be shared.</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>上面的意思就是说： String字符串是一个常量，String实例创建之后，它的的值是不能被改变的，但是字符缓冲区是支持可变的字符串，因为缓冲区里面的不可变字符串对象们可以被共享。(发生对象的引用)。</p>
<p>再来看String在jdk1.8中的定义<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span></span></div><div class="line">    <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">Comparable</span>&lt;<span class="title">String</span>&gt;, <span class="title">CharSequence</span> &#123;</div><div class="line">    <span class="comment">/** The value is used for character storage. */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span> value[];</div><div class="line"></div><div class="line">    <span class="comment">/** Cache the hash code for the string */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> hash; <span class="comment">// Default to 0</span></div><div class="line"></div><div class="line">    <span class="comment">/** use serialVersionUID from JDK 1.0.2 for interoperability */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">6849794470754667710L</span>;</div><div class="line">    <span class="comment">//..... 等等代码</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以看出String 是final类型，表示该类就不能被其他类继承了，同时实现了序列化，比较、字符序列的接口。</p>
<blockquote>
<p>Java的序列化机制是通过在运行时判断类的serialVersionUID来验证版本的一致性的，在进行反序列化是，JVM会把传过来的字节流中的seriaVersionUID与本地相应实体(类)的serialVersionUID进行比较，如果相同就认为是一致的，就可以进行反序列化，否则就会出现序列化版本不一致的异常(InvalidCastException)。</p>
<p>在Java中，被final类型修饰的类是不允许被其他类继承的，被final修饰的变量被复制后是不允许被修改的。</p>
</blockquote>
<p>在研究上面的这段源码，我们知道，<strong>String 就是用一个char 数组来保存的，这个数组中是被final修饰的。， 同时String 的默认的hashCode(哈希值)值为0</strong></p>
<h2 id="构造器"><a href="#构造器" class="headerlink" title="构造器"></a><strong>构造器</strong></h2><p>我们先看看String的构造器源代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">    * Initializes a newly created &#123;<span class="doctag">@code</span> String&#125; object so that it represents</div><div class="line">    * an empty character sequence.  Note that use of this constructor is</div><div class="line">    * unnecessary since Strings are immutable.</div><div class="line">    */</div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">this</span>.value = <span class="string">""</span>.value;</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(String original)</span> </span>&#123;</div><div class="line">       <span class="keyword">this</span>.value = original.value;</div><div class="line">       <span class="keyword">this</span>.hash = original.hash;</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">char</span> value[])</span> </span>&#123;</div><div class="line">       <span class="keyword">this</span>.value = Arrays.copyOf(value, value.length);</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">     <span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">char</span> value[], <span class="keyword">int</span> offset, <span class="keyword">int</span> count)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (offset &lt; <span class="number">0</span>) &#123;</div><div class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(offset);</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">if</span> (count &lt;= <span class="number">0</span>) &#123;</div><div class="line">           <span class="keyword">if</span> (count &lt; <span class="number">0</span>) &#123;</div><div class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(count);</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">if</span> (offset &lt;= value.length) &#123;</div><div class="line">               <span class="keyword">this</span>.value = <span class="string">""</span>.value;</div><div class="line">               <span class="keyword">return</span>;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       <span class="comment">// Note: offset or count might be near -1&gt;&gt;&gt;1.</span></div><div class="line">       <span class="keyword">if</span> (offset &gt; value.length - count) &#123;</div><div class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(offset + count);</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">this</span>.value = Arrays.copyOfRange(value, offset, offset+count);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">int</span>[] codePoints, <span class="keyword">int</span> offset, <span class="keyword">int</span> count)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (offset &lt; <span class="number">0</span>) &#123;</div><div class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(offset);</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">if</span> (count &lt;= <span class="number">0</span>) &#123;</div><div class="line">           <span class="keyword">if</span> (count &lt; <span class="number">0</span>) &#123;</div><div class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(count);</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">if</span> (offset &lt;= codePoints.length) &#123;</div><div class="line">               <span class="keyword">this</span>.value = <span class="string">""</span>.value;</div><div class="line">               <span class="keyword">return</span>;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       <span class="comment">// Note: offset or count might be near -1&gt;&gt;&gt;1.</span></div><div class="line">       <span class="keyword">if</span> (offset &gt; codePoints.length - count) &#123;</div><div class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(offset + count);</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="keyword">final</span> <span class="keyword">int</span> end = offset + count;</div><div class="line"></div><div class="line">       <span class="comment">// Pass 1: Compute precise size of char[]</span></div><div class="line">       <span class="keyword">int</span> n = count;</div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = offset; i &lt; end; i++) &#123;</div><div class="line">           <span class="keyword">int</span> c = codePoints[i];</div><div class="line">           <span class="keyword">if</span> (Character.isBmpCodePoint(c))</div><div class="line">               <span class="keyword">continue</span>;</div><div class="line">           <span class="keyword">else</span> <span class="keyword">if</span> (Character.isValidCodePoint(c))</div><div class="line">               n++;</div><div class="line">           <span class="keyword">else</span> <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(Integer.toString(c));</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="comment">// Pass 2: Allocate and fill in char[]</span></div><div class="line">       <span class="keyword">final</span> <span class="keyword">char</span>[] v = <span class="keyword">new</span> <span class="keyword">char</span>[n];</div><div class="line"></div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = offset, j = <span class="number">0</span>; i &lt; end; i++, j++) &#123;</div><div class="line">           <span class="keyword">int</span> c = codePoints[i];</div><div class="line">           <span class="keyword">if</span> (Character.isBmpCodePoint(c))</div><div class="line">               v[j] = (<span class="keyword">char</span>)c;</div><div class="line">           <span class="keyword">else</span></div><div class="line">               Character.toSurrogates(c, v, j++);</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="keyword">this</span>.value = v;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="comment">// 字节数组构造器</span></div><div class="line">     <span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">byte</span> bytes[], Charset charset)</span> </span>&#123;</div><div class="line">       <span class="keyword">this</span>(bytes, <span class="number">0</span>, bytes.length, charset);</div><div class="line">   &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">byte</span> bytes[], <span class="keyword">int</span> offset, <span class="keyword">int</span> length, String charsetName)</span></span></div><div class="line">           <span class="keyword">throws</span> UnsupportedEncodingException &#123;</div><div class="line">       <span class="keyword">if</span> (charsetName == <span class="keyword">null</span>)</div><div class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"charsetName"</span>);</div><div class="line">       checkBounds(bytes, offset, length);</div><div class="line">       <span class="keyword">this</span>.value = StringCoding.decode(charsetName, bytes, offset, length);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h3 id="无参数造器"><a href="#无参数造器" class="headerlink" title="无参数造器"></a><strong>无参数造器</strong></h3><p>从上面的<strong>无参数构造器中可以发现，内部是创建了一个空的字符串对String 的value字符数组进行初始化的，所以这样的方法是会增加不必要的字符串对象(空字符串)</strong>，所以尽量不要使用如下的方法创建String对象的实例:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">String str = <span class="keyword">new</span> String();</div><div class="line">str = <span class="string">"hello"</span>;</div></pre></td></tr></table></figure></p>
<h3 id="字符串参数构造器"><a href="#字符串参数构造器" class="headerlink" title="字符串参数构造器"></a><strong>字符串参数构造器</strong></h3><p>从上面的源代码可以看到，传入的字符串直接赋值给了目标字符串的字符数组，和哈希值。所以保证了原来的String字符对象的变不会影响到新的String对象，通过这个方法构造的额字符对象与原来的是一个不一样的对象。</p>
<h3 id="字符数组构造器"><a href="#字符数组构造器" class="headerlink" title="字符数组构造器"></a><strong>字符数组构造器</strong></h3><p>源码中给出了字符数组的多种形式的构造器</p>
<h4 id="第一种"><a href="#第一种" class="headerlink" title="第一种"></a><strong>第一种</strong></h4><p>第一种的字符数组，将整个字符数组转化为Sting对象，使用的方法是<code>Arrays.copyof(char[], int)</code>将字符数组中的所有字符复制到目标String的value字符数组中。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">    Arrays.copyof() 源码</div><div class="line">*/</div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">char</span>[] copyOf(<span class="keyword">char</span>[] original, <span class="keyword">int</span> newLength) &#123;</div><div class="line">        <span class="keyword">char</span>[] copy = <span class="keyword">new</span> <span class="keyword">char</span>[newLength];</div><div class="line">        System.arraycopy(original, <span class="number">0</span>, copy, <span class="number">0</span>,</div><div class="line">                         Math.min(original.length, newLength));</div><div class="line">        <span class="keyword">return</span> copy;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>从这里可以看出，是直接创建一个字符数组，调用系统的数组复制的方法，将新创建的字符数组对象返回， 而系统的数组复制的这个方法是一个<code>native</code>方法。 <code>native</code>方法不是用java实现的了，一般是用C或C++实现的了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// System 类中的arraycop native方法。</span></div><div class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">arraycopy</span><span class="params">(Object src,  <span class="keyword">int</span>  srcPos,</span></span></div><div class="line">                                        Object dest, <span class="keyword">int</span> destPos,</div><div class="line">                                        <span class="keyword">int</span> length);</div></pre></td></tr></table></figure>
<h4 id="字符数组、个数的构造器"><a href="#字符数组、个数的构造器" class="headerlink" title="字符数组、个数的构造器"></a><strong>字符数组、个数的构造器</strong></h4><p>从参数中可以看出，第二个参数是偏移量，第三个参数是要送字符数组中转化成Sting对象的字符个数。<br>在构造方法里面，进行了offset 和count数值的异常检查， 最后调用<code>Arrays.copyOfRange(char[],int, int)</code> 方法对字符数组进行复制。我们来看这个方法是怎么实现的吧：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// </span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">char</span>[] copyOfRange(<span class="keyword">char</span>[] original, <span class="keyword">int</span> from, <span class="keyword">int</span> to) &#123;</div><div class="line">        <span class="keyword">int</span> newLength = to - from;</div><div class="line">        <span class="keyword">if</span> (newLength &lt; <span class="number">0</span>)</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(from + <span class="string">" &gt; "</span> + to);</div><div class="line">        <span class="keyword">char</span>[] copy = <span class="keyword">new</span> <span class="keyword">char</span>[newLength];</div><div class="line">        System.arraycopy(original, from, copy, <span class="number">0</span>,</div><div class="line">                         Math.min(original.length - from, newLength));</div><div class="line">        <span class="keyword">return</span> copy;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>从源码中可以知道也是检查了一些常规的数值检查吗，然后创建新的字符数组对象，调用系统的arraycopy()方法进行过复制。</p>
<h4 id="使用字节数组的构造器"><a href="#使用字节数组的构造器" class="headerlink" title="使用字节数组的构造器"></a><strong>使用字节数组的构造器</strong></h4><p>在Java中，Sting 实例中保存了一个char[] 字符数组，char[]字符数组是以unicode码来存储的，Sring 和char为内存形式。byte是网络传输或存储的序列化形式，所以在很多的传输和存储的过程中需要将byte[] 数组和String进行相互的转化，所以String提供了一系列重载和构造方法将一个字节数组转化成String，当提到字节数组和String之间的相互转换的就不得不关注编码的问题。出现乱码的问题主要是编码和解码的方式不一样而导致的，所以有指定字符集(charset)来解码指定的byte数组，将其解码成unicode的char[]数组。这样就能避免乱码的问题。<br>我们从上面的构造方法中我们可以看到，首先进行的是边界的检查，然后调用的是<code>StringCoding.decode(charsetName, bytes, offset, length);</code>的方法，返回字符数组。源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//StringDoding.class 的decode()方法</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">char</span>[] decode(String charsetName, <span class="keyword">byte</span>[] ba, <span class="keyword">int</span> off, <span class="keyword">int</span> len)</div><div class="line">        <span class="keyword">throws</span> UnsupportedEncodingException</div><div class="line">    &#123;</div><div class="line">        StringDecoder sd = deref(decoder);</div><div class="line">        String csn = (charsetName == <span class="keyword">null</span>) ? <span class="string">"ISO-8859-1"</span> : charsetName;</div><div class="line">        <span class="keyword">if</span> ((sd == <span class="keyword">null</span>) || !(csn.equals(sd.requestedCharsetName())</div><div class="line">                              || csn.equals(sd.charsetName()))) &#123;</div><div class="line">            sd = <span class="keyword">null</span>;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                Charset cs = lookupCharset(csn);</div><div class="line">                <span class="keyword">if</span> (cs != <span class="keyword">null</span>)</div><div class="line">                    sd = <span class="keyword">new</span> StringDecoder(cs, csn);</div><div class="line">            &#125; <span class="keyword">catch</span> (IllegalCharsetNameException x) &#123;&#125;</div><div class="line">            <span class="keyword">if</span> (sd == <span class="keyword">null</span>)</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedEncodingException(csn);</div><div class="line">            set(decoder, sd);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> sd.decode(ba, off, len);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>我们需要知道的是。使用byte[] 字节数组构造String的时候，如果没有指明解码使用的字符集的话，那么StringCoding的decode方法首先会调用系统默认的编码格式，默认是ISO-8859-1编码格式进行操作。</p>
<h2 id="主要方法"><a href="#主要方法" class="headerlink" title="主要方法"></a><strong>主要方法</strong></h2><h3 id="hashCode的实现"><a href="#hashCode的实现" class="headerlink" title="hashCode的实现"></a><strong>hashCode的实现</strong></h3><p>我们探讨String的hashCode之前先来看看hashCode的官方定义:</p>
<blockquote>
<p>hashcode方法返回该对象的哈希码值。支持该方法是为哈希表提供一些优点，例如，java.util.Hashtable 提供的哈希表。<br>hashCode 的常规协定是：<br>在 Java 应用程序执行期间，在同一对象上多次调用 hashCode 方法时，必须一致地返回相同的整数，前提是对象上 equals 比较中所用的信息没有被修改。从某一应用程序的一次执行到同一应用程序的另一次执行，该整数无需保持一致。<br>如果根据 equals(Object) 方法，两个对象是相等的，那么在两个对象中的每个对象上调用 hashCode 方法都必须生成相同的整数结果。<br>以下情况不 是必需的：如果根据 equals(java.lang.Object) 方法，两个对象不相等，那么在两个对象中的任一对象上调用 hashCode 方法必定会生成不同的整数结果。但是，程序员应该知道，为不相等的对象生成不同整数结果可以提高哈希表的性能。<br>实际上，由 Object 类定义的 hashCode 方法确实会针对不同的对象返回不同的整数。（这一般是通过将该对象的内部地址转换成一个整数来实现的，但是 JavaTM 编程语言不需要这种实现技巧。）<br>当equals方法被重写时，通常有必要重写 hashCode 方法，以维护 hashCode 方法的常规协定，该协定声明相等对象必须具有相等的哈希码。 </p>
</blockquote>
<p>由此我们可以知道，hashCode的哈希值最基本的作用是区分不同的对象。那么String的hashCode是怎么实现的呢?我们探究一下这个hashCode的具体实现吧，如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// String类中的hashCode的实现。</span></div><div class="line"> <span class="comment">/**</span></div><div class="line">     * Returns a hash code for this string. The hash code for a</div><div class="line">     * &#123;<span class="doctag">@code</span> String&#125; object is computed as</div><div class="line">     * &lt;blockquote&gt;&lt;pre&gt;</div><div class="line">     * s[0]*31^(n-1) + s[1]*31^(n-2) + ... + s[n-1]</div><div class="line">     * &lt;/pre&gt;&lt;/blockquote&gt;</div><div class="line">     * using &#123;<span class="doctag">@code</span> int&#125; arithmetic, where &#123;<span class="doctag">@code</span> s[i]&#125; is the</div><div class="line">     * &lt;i&gt;i&lt;/i&gt;th character of the string, &#123;<span class="doctag">@code</span> n&#125; is the length of</div><div class="line">     * the string, and &#123;<span class="doctag">@code</span> ^&#125; indicates exponentiation.</div><div class="line">     * (The hash value of the empty string is zero.)</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span>  a hash code value for this object.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> h = hash;</div><div class="line">        <span class="keyword">if</span> (h == <span class="number">0</span> &amp;&amp; value.length &gt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">char</span> val[] = value;</div><div class="line"></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; value.length; i++) &#123;</div><div class="line">                h = <span class="number">31</span> * h + val[i];</div><div class="line">            &#125;</div><div class="line">            hash = h;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> h;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><strong>从源码中可以知道，String是重写了Object中的hashCode的方法，该方法是native方法，String 中的 hashCode的计算过程是：先判断hash是否被计算过，并且字符串不为空，则进行hashCode计算， 然后计算的hashCode的方式是<code>s[0]*31^(n-1)+s[1]*31^(n-2)+ ... + s[n-1]</code> 通过多项式计算而来，所以我们完全可以通过不同的字符串得出的相同的哈希值，所以两个String对象的hashCode相同，并不代表两个String 是一样的。(可以这么想：既然hashCode都是自己可以重写的，那么我自己设计hashCode值计算方式的时候，可能就会不同对象计算出相同的值。)</strong></p>
<h3 id="trim"><a href="#trim" class="headerlink" title="trim()"></a><strong>trim()</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">trim</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">int</span> len = value.length;</div><div class="line">       <span class="keyword">int</span> st = <span class="number">0</span>;</div><div class="line">       <span class="keyword">char</span>[] val = value;    <span class="comment">/* avoid getfield opcode */</span></div><div class="line"></div><div class="line">       <span class="keyword">while</span> ((st &lt; len) &amp;&amp; (val[st] &lt;= <span class="string">' '</span>)) &#123;</div><div class="line">           st++;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">while</span> ((st &lt; len) &amp;&amp; (val[len - <span class="number">1</span>] &lt;= <span class="string">' '</span>)) &#123;</div><div class="line">           len--;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> ((st &gt; <span class="number">0</span>) || (len &lt; value.length)) ? substring(st, len) : <span class="keyword">this</span>;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h3 id="intern"><a href="#intern" class="headerlink" title="intern"></a><strong>intern</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"> <span class="comment">/**</span></div><div class="line">  * Returns a canonical representation for the string object.</div><div class="line">  * &lt;p&gt;</div><div class="line">  * A pool of strings, initially empty, is maintained privately by the</div><div class="line">  * class &#123;<span class="doctag">@code</span> String&#125;.</div><div class="line">  * &lt;p&gt;</div><div class="line">  * When the intern method is invoked, if the pool already contains a</div><div class="line">  * string equal to this &#123;<span class="doctag">@code</span> String&#125; object as determined by</div><div class="line">  * the &#123;<span class="doctag">@link</span> #equals(Object)&#125; method, then the string from the pool is</div><div class="line">  * returned. Otherwise, this &#123;<span class="doctag">@code</span> String&#125; object is added to the</div><div class="line">  * pool and a reference to this &#123;<span class="doctag">@code</span> String&#125; object is returned.</div><div class="line">  * &lt;p&gt;</div><div class="line">  * It follows that for any two strings &#123;<span class="doctag">@code</span> s&#125; and &#123;<span class="doctag">@code</span> t&#125;,</div><div class="line">  * &#123;<span class="doctag">@code</span> s.intern() == t.intern()&#125; is &#123;<span class="doctag">@code</span> true&#125;</div><div class="line">  * if and only if &#123;<span class="doctag">@code</span> s.equals(t)&#125; is &#123;<span class="doctag">@code</span> true&#125;.</div><div class="line">  * &lt;p&gt;</div><div class="line">  * All literal strings and string-valued constant expressions are</div><div class="line">  * interned. String literals are defined in section 3.10.5 of the</div><div class="line">  * &lt;cite&gt;The Java&amp;trade; Language Specification&lt;/cite&gt;.</div><div class="line">  *</div><div class="line">  * <span class="doctag">@return</span>  a string that has the same contents as this string, but is</div><div class="line">  *          guaranteed to be from a pool of unique strings.</div><div class="line">  */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">intern</span><span class="params">()</span></span>;</div></pre></td></tr></table></figure>
<p>intern方法是Native调用，它的作用是在方法区中的常量池中通过equals方法寻找等值的对象，如果没有找到则在常量池中开辟一片空间存放字符串并返回该对应String的引用，否则直接返回常量池中已经存在的String对象的引用。</p>
<p><strong>例如</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">String  st = <span class="keyword">new</span> String(<span class="string">"hello"</span>);</div><div class="line">String  st2 = <span class="string">"hello"</span>;</div><div class="line">System.out.println(st == st2);</div></pre></td></tr></table></figure></p>
<p>上面的输出是false，原因是st 和st2指向的是不同的两个对象，内存的地址值是不同的。<br>但是使用intern()方法会有什么样的效果呢？<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">String  st = <span class="string">"hello"</span>;</div><div class="line">String st2 = <span class="keyword">new</span> String(<span class="string">"hello"</span>).intern();</div><div class="line">System.out.println(st==st2);</div></pre></td></tr></table></figure></p>
<p>上述代码输出的是true， 因为st指向的地址来自于常量池中，而st2创建字符对象的时候，是从常量池中去寻找是有相同的字符串，如果有，就返回地址，没有就在常量池中创建新的字符串。所以上面的代码输出的是true。</p>
<h3 id="equals"><a href="#equals" class="headerlink" title="equals"></a><strong>equals</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">    * Compares this string to the specified object.  The result is &#123;<span class="doctag">@code</span></div><div class="line">    * true&#125; if and only if the argument is not &#123;<span class="doctag">@code</span> null&#125; and is a &#123;<span class="doctag">@code</span></div><div class="line">    * String&#125; object that represents the same sequence of characters as this</div><div class="line">    * object.</div><div class="line">    *</div><div class="line">    * <span class="doctag">@param</span>  anObject</div><div class="line">    *         The object to compare this &#123;<span class="doctag">@code</span> String&#125; against</div><div class="line">    *</div><div class="line">    * <span class="doctag">@return</span>  &#123;<span class="doctag">@code</span> true&#125; if the given object represents a &#123;<span class="doctag">@code</span> String&#125;</div><div class="line">    *          equivalent to this string, &#123;<span class="doctag">@code</span> false&#125; otherwise</div><div class="line">    *</div><div class="line">    * <span class="doctag">@see</span>  #compareTo(String)</div><div class="line">    * <span class="doctag">@see</span>  #equalsIgnoreCase(String)</div><div class="line">    */</div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object anObject)</span> </span>&#123;</div><div class="line">       <span class="comment">// 如果引用的是同一个 对象，返回真</span></div><div class="line">       <span class="keyword">if</span> (<span class="keyword">this</span> == anObject) &#123;</div><div class="line">           <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">       &#125;</div><div class="line">       <span class="comment">//如果不是String 类型的数据，就返回假</span></div><div class="line">       <span class="keyword">if</span> (anObject <span class="keyword">instanceof</span> String) &#123;</div><div class="line">           String anotherString = (String)anObject;</div><div class="line">           <span class="keyword">int</span> n = value.length;</div><div class="line">           <span class="comment">//如果char数组长度不相等，返回假</span></div><div class="line">           <span class="keyword">if</span> (n == anotherString.value.length) &#123;</div><div class="line">               <span class="keyword">char</span> v1[] = value;</div><div class="line">               <span class="keyword">char</span> v2[] = anotherString.value;</div><div class="line">               <span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line">               <span class="comment">//从后先前单个字符判断，如果有不相等的，则返回假</span></div><div class="line">               <span class="keyword">while</span> (n-- != <span class="number">0</span>) &#123;</div><div class="line">                   <span class="keyword">if</span> (v1[i] != v2[i])</div><div class="line">                       <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                   i++;</div><div class="line">               &#125;</div><div class="line">               <span class="comment">// 如果每个字符都是相等，就返回真</span></div><div class="line">               <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>equals方式是经常用到的，最常用来比较两个字符串字符内容是否是相等的，那么由上面可以知道，String对象的判断规则是:</p>
<ol>
<li>内存地址相同，则为真。</li>
<li>如果对象类型不是String类型，则为假，否则继续判断。</li>
<li>如果对象长度不相等，则为假否则继续判断。</li>
<li>从后往前，判断String类中char数组value的单个字符是否相等，有不相等则为假，如果一直到第一个数，则返回真。</li>
</ol>
<h3 id="compareTo"><a href="#compareTo" class="headerlink" title="compareTo()"></a><strong>compareTo()</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">*/</div><div class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(String anotherString)</span> </span>&#123;</div><div class="line"> <span class="comment">//比较字符串的长度</span></div><div class="line">     <span class="keyword">int</span> len1 = value.length;</div><div class="line">     <span class="comment">//被比较的字符串的长度</span></div><div class="line">     <span class="keyword">int</span> len2 = anotherString.value.length;</div><div class="line">     <span class="comment">//取两个字符串中较短的</span></div><div class="line">     <span class="keyword">int</span> lim = Math.min(len1, len2);</div><div class="line">     <span class="keyword">char</span> v1[] = value;</div><div class="line">     <span class="keyword">char</span> v2[] = anotherString.value;</div><div class="line">     <span class="comment">//从第一个字符串开始比较，如果字符不相等，返回两个字符的差值</span></div><div class="line">     <span class="keyword">int</span> k = <span class="number">0</span>;</div><div class="line">     <span class="keyword">while</span> (k &lt; lim) &#123;</div><div class="line">         <span class="keyword">char</span> c1 = v1[k];</div><div class="line">         <span class="keyword">char</span> c2 = v2[k];</div><div class="line">         <span class="keyword">if</span> (c1 != c2) &#123;</div><div class="line">             <span class="keyword">return</span> c1 - c2;</div><div class="line">         &#125;</div><div class="line">         k++;</div><div class="line">     &#125;</div><div class="line">     <span class="comment">//较短的比较完之后，还有则返回自身长度- 被比较的对象的长度。</span></div><div class="line">     <span class="keyword">return</span> len1 - len2;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>String中的<code>compareTo</code>方法的比较方法是基于每个字符的Unicode的值进行比较的，比较的内容是文本的内容。</p>
<h3 id="substring"><a href="#substring" class="headerlink" title="substring()"></a><strong>substring()</strong></h3><p>substring是一个使用起来非常方便的方法了，在我们对String的日常操作中是经常使用到的。当然这个方法方便的同时，也要小心使用，尤其是方法中的参数，如果参数没有弄清楚，哈哈，那么可能就得不到你想要的结果哦！那么看看String中是怎么实现的吧！图下面的代码所示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//String类中的substring 源码</span></div><div class="line">   <span class="comment">/**</span></div><div class="line">     * Returns a string that is a substring of this string. The</div><div class="line">     * substring begins at the specified &#123;<span class="doctag">@code</span> beginIndex&#125; and</div><div class="line">     * extends to the character at index &#123;<span class="doctag">@code</span> endIndex - 1&#125;.</div><div class="line">     * Thus the length of the substring is &#123;<span class="doctag">@code</span> endIndex-beginIndex&#125;.</div><div class="line">     * &lt;p&gt;</div><div class="line">     * Examples:</div><div class="line">     * &lt;blockquote&gt;&lt;pre&gt;</div><div class="line">     * "hamburger".substring(4, 8) returns "urge"</div><div class="line">     * "smiles".substring(1, 5) returns "mile"</div><div class="line">     * &lt;/pre&gt;&lt;/blockquote&gt;</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span>      beginIndex   the beginning index, inclusive.</div><div class="line">     * <span class="doctag">@param</span>      endIndex     the ending index, exclusive.</div><div class="line">     * <span class="doctag">@return</span>     the specified substring.</div><div class="line">     * <span class="doctag">@exception</span>  IndexOutOfBoundsException  if the</div><div class="line">     *             &#123;<span class="doctag">@code</span> beginIndex&#125; is negative, or</div><div class="line">     *             &#123;<span class="doctag">@code</span> endIndex&#125; is larger than the length of</div><div class="line">     *             this &#123;<span class="doctag">@code</span> String&#125; object, or</div><div class="line">     *             &#123;<span class="doctag">@code</span> beginIndex&#125; is larger than</div><div class="line">     *             &#123;<span class="doctag">@code</span> endIndex&#125;.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">substring</span><span class="params">(<span class="keyword">int</span> beginIndex, <span class="keyword">int</span> endIndex)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (beginIndex &lt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(beginIndex);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (endIndex &gt; value.length) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(endIndex);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> subLen = endIndex - beginIndex;</div><div class="line">        <span class="keyword">if</span> (subLen &lt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(subLen);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> ((beginIndex == <span class="number">0</span>) &amp;&amp; (endIndex == value.length)) ? <span class="keyword">this</span></div><div class="line">                : <span class="keyword">new</span> String(value, beginIndex, subLen);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>从上面的代码中可以知道，这个方法做了参数数值的异常处理，然后重要的是在返回上，如果截取的是和原来一致的，那么就返回原来的字符对象，否则的化，构造了一个新的字符串，所以substring都是并没有对原字符串的修改。</p>
<p>注意点:</p>
<blockquote>
<p>该方法</p>
</blockquote>
<h3 id="trim-1"><a href="#trim-1" class="headerlink" title="trim()"></a><strong>trim()</strong></h3><p>trim()方法也是我们常用的方法，经常用作表单中对用户输入数据的处理，去除前后的空格，怎么做到的呢？直接上源码吧！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// String类中的trim()方法源码</span></div><div class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">trim</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> len = value.length;</div><div class="line">        <span class="keyword">int</span> st = <span class="number">0</span>;</div><div class="line">        <span class="keyword">char</span>[] val = value;    <span class="comment">/* avoid getfield opcode */</span></div><div class="line">        <span class="comment">//找到前面没有空格的位置</span></div><div class="line">        <span class="keyword">while</span> ((st &lt; len) &amp;&amp; (val[st] &lt;= <span class="string">' '</span>)) &#123;</div><div class="line">            st++;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//找到后面没有空格的位置</span></div><div class="line">        <span class="keyword">while</span> ((st &lt; len) &amp;&amp; (val[len - <span class="number">1</span>] &lt;= <span class="string">' '</span>)) &#123;</div><div class="line">            len--;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 如果前后没有空格，返回原字符串，否则，通过截取，构建新的字符串，</span></div><div class="line">        <span class="keyword">return</span> ((st &gt; <span class="number">0</span>) || (len &lt; value.length)) ? substring(st, len) : <span class="keyword">this</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h2><p>String 对象是不可变类型，返回类型为String 的String方法除了和原字符串相同的情况下返回原字符串，其他的都是返回新的String对象。<br>String对象的三种比较方式：</p>
<ul>
<li>== 是内存的比较:直接对比两个引用的内存值，精确简洁直接明了。</li>
<li>equals比较: 比较两个引用所指向对象字面值是否相等。</li>
<li>hashCode数值比较：将字符串数值化，两个引用的hashCode相同，不保证内存一定相同，不保证字面值一定相同。</li>
</ul>
<h1 id="StringBuffer"><a href="#StringBuffer" class="headerlink" title="StringBuffer"></a><strong>StringBuffer</strong></h1><h2 id="StringBuffer概述"><a href="#StringBuffer概述" class="headerlink" title="StringBuffer概述"></a><strong>StringBuffer概述</strong></h2><p>上面讲解了String的源码解析，知道了最基本的一个概念是String对象是不可变的，但是StringBuffer是怎么样的呢？或许你学习过Java的人会有一点认识就是StringBuffer是可变的，那么到底是不是呢？我们马上上源码。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * A thread-safe, mutable sequence of characters.</div><div class="line"> * A string buffer is like a &#123;<span class="doctag">@link</span> String&#125;, but can be modified. At any</div><div class="line"> * point in time it contains some particular sequence of characters, but</div><div class="line"> * the length and content of the sequence can be changed through certain</div><div class="line"> * method calls.</div><div class="line"> * &lt;p&gt;</div><div class="line"> * String buffers are safe for use by multiple threads. The methods</div><div class="line"> * are synchronized where necessary so that all the operations on any</div><div class="line"> * particular instance behave as if they occur in some serial order</div><div class="line"> * that is consistent with the order of the method calls made by each of</div><div class="line"> * the individual threads involved.</div><div class="line"> * &lt;p&gt;</div><div class="line"> * The principal operations on a &#123;<span class="doctag">@code</span> StringBuffer&#125; are the</div><div class="line"> * &#123;<span class="doctag">@code</span> append&#125; and &#123;<span class="doctag">@code</span> insert&#125; methods, which are</div><div class="line"> * overloaded so as to accept data of any type. Each effectively</div><div class="line"> * converts a given datum to a string and then appends or inserts the</div><div class="line"> * characters of that string to the string buffer. The</div><div class="line"> * &#123;<span class="doctag">@code</span> append&#125; method always adds these characters at the end</div><div class="line"> * of the buffer; the &#123;<span class="doctag">@code</span> insert&#125; method adds the characters at</div><div class="line"> * a specified point.</div><div class="line"> * &lt;p&gt;</div><div class="line"> */</div><div class="line"> <span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StringBuffer</span></span></div><div class="line">    <span class="keyword">extends</span> <span class="title">AbstractStringBuilder</span></div><div class="line">    <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">CharSequence</span></div></pre></td></tr></table></figure></p>
<p>从上面对StringBuffer类是final的，那么也就是这个类不能被继承了，从定义中可以看到，StringBuffer是实现了序列化和字符序列。同时继承了抽象的AbstractStringBuilder。<br>从文档解释上可以得到:StringBuffer是一个线程安全，可变的字符序列。它像String， 但是和String不同的是可以被改变，在任何时候，它包含一些特定的字符序列，但是字符序列的长度和内容是可以通过方法的调用进行改变的。所以说是可变的。<br>StringBuffer 是线程安全的，想必有写人肯定也听说过，到底是不是呢？看他的解释吧!<br>从第二段解释中可以看到，StringBuffer是线程安全的，可以载多线程环境下使用。StringBuffer里面的方法进行了同步，所以在任何的实例对象对StringBuffer对象进行操作的时候能够串行的执行，就像是和单独的线程调用效果是一样的。它能够在多线程环境下使用，那么肯定是采取了同步的措施，那么它的措施是什么呢？看下面的源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//StringBuffer类源码中的主要的方法。</span></div><div class="line"><span class="comment">// 构造方法里面是默认的16个字符大小加上传入的字符序列长度大小</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">StringBuffer</span><span class="params">(CharSequence seq)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>(seq.length() + <span class="number">16</span>);</div><div class="line">    append(seq);</div><div class="line">&#125;</div><div class="line"><span class="comment">//StringBuffer的方法大部分是使用了synchronized方法进行了同步</span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">length</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> count;</div><div class="line">&#125;</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">capacity</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> value.length;</div><div class="line">&#125;</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">(<span class="keyword">int</span> minimumCapacity)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (minimumCapacity &gt; value.length) &#123;</div><div class="line">        expandCapacity(minimumCapacity);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@since</span>      1.5</div><div class="line"> */</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">trimToSize</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.trimToSize();</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@throws</span> IndexOutOfBoundsException &#123;<span class="doctag">@inheritDoc</span>&#125;</div><div class="line"> * <span class="doctag">@see</span>        #length()</div><div class="line"> */</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">setLength</span><span class="params">(<span class="keyword">int</span> newLength)</span> </span>&#123;</div><div class="line">    toStringCache = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">super</span>.setLength(newLength);</div><div class="line">&#125;</div><div class="line">....</div></pre></td></tr></table></figure>
<p>从StringBufferd的源码可以知道，StringBuffer的同步采用的措施主要是使用关键字<code>synchronized</code>对方法进行同步。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * A cache of the last value returned by toString. Cleared</div><div class="line"> * whenever the StringBuffer is modified.</div><div class="line"> */</div><div class="line"> <span class="comment">// 字符缓冲区</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">char</span>[] toStringCache;</div><div class="line"></div><div class="line"><span class="comment">/** use serialVersionUID from JDK 1.0.2 for interoperability */</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">3388685877147921107L</span>;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Constructs a string buffer with no characters in it and an</div><div class="line"> * initial capacity of 16 characters.</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">StringBuffer</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>(<span class="number">16</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>从上面源码中的成员变量和构造方法可以知道，StringBuffer的实现还是和String一样是字符数组(通过super（）,在父类中有一个字符数组)，但是使用默认对的构造方法创建StringBuffer实例的时候是默认字符数组的大小是16个字符的。见如下的源码:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractStringBuilder</span> <span class="keyword">implements</span> <span class="title">Appendable</span>, <span class="title">CharSequence</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * The value is used for character storage.</div><div class="line">     */</div><div class="line">    <span class="keyword">char</span>[] value;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * The count is the number of characters used.</div><div class="line">     */</div><div class="line">    <span class="keyword">int</span> count;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * This no-arg constructor is necessary for serialization of subclasses.</div><div class="line">     */</div><div class="line">    AbstractStringBuilder() &#123;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Creates an AbstractStringBuilder of the specified capacity.</div><div class="line">     */</div><div class="line">    AbstractStringBuilder(<span class="keyword">int</span> capacity) &#123;</div><div class="line">        value = <span class="keyword">new</span> <span class="keyword">char</span>[capacity];</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>父类中有一个value字符数组用于保存里面的字符数据，同时又一个count用来保存数组中已经使用了的个数。</p>
<p>StringBuffer成员变量中有一个字符缓冲区<code>toStringBuffer</code>，这个字符缓冲区主要用于保存最后一次调用toString（）时的字符值，当StringBuffer被修改的时候，这个缓冲区将会被修改。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@since</span>   JDK1.0.2</div><div class="line">     */</div><div class="line">     <span class="comment">//当StringBuffer修改了之后，字符缓冲区是会被清空的</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> StringBuffer <span class="title">reverse</span><span class="params">()</span> </span>&#123;</div><div class="line">        toStringCache = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">super</span>.reverse();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment">//当调用toString方法的时候，将会把字符数组中的数据放入缓冲区中。</span></div><div class="line">  <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (toStringCache == <span class="keyword">null</span>) &#123;</div><div class="line">            toStringCache = Arrays.copyOfRange(value, <span class="number">0</span>, count);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String(toStringCache, <span class="keyword">true</span>);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>从上面的源码中可以知道，StringBuffer中大部分的方法是同步的，在会对StringBuffer对象进行修改的方法中，会将StringBuffer中的缓冲区<code>toStringCache</code>清空(赋值为null)，但是单调toString()方法的时候，将会把自己的字符数组中数据复制到缓冲区中，然后返一个新的String对象，我们从String源码中也可以看到带字节数组中的构造方法里是这个样的:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">char</span>[] vlaue)</span></span>&#123;</div><div class="line">    <span class="keyword">this</span>.value = vlaue;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>从中我们可以看到，使用这个String构造方法构造出来的String对象不没有实际复制字符串，只是把value指向了构造参数，所以这样是一种节省空间和时间的操作。</p>
</blockquote>
<h2 id="主要方法-1"><a href="#主要方法-1" class="headerlink" title="主要方法"></a><strong>主要方法</strong></h2><h3 id="append"><a href="#append" class="headerlink" title="append"></a><strong>append</strong></h3><p>append学过java的人肯定是知道这个方法的。这个方法真个是很好用呀！那么它是怎么实现的呢？<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> StringBuffer <span class="title">append</span><span class="params">(Object obj)</span> </span>&#123;</div><div class="line">    toStringCache = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">super</span>.append(String.valueOf(obj));</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> StringBuffer <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</div><div class="line">    toStringCache = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">super</span>.append(str);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>StringBuffer中的append()方法，调用的都是父类<code>AbstractStringBuilder</code>中的<code>append</code>方法，那父类中的又是怎么实现的呢？看下面的源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> AbstractStringBuilder <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</div><div class="line"><span class="comment">//当str为null时，将会在当前字符串对象的后面添加"null"字符串的。</span></div><div class="line">     <span class="keyword">if</span> (str == <span class="keyword">null</span>)</div><div class="line">         <span class="keyword">return</span> appendNull();</div><div class="line">     <span class="comment">//获取需要添加的字符串的长度</span></div><div class="line">     <span class="keyword">int</span> len = str.length();</div><div class="line">     <span class="comment">// 详见后面的说明</span></div><div class="line">     ensureCapacityInternal(count + len);</div><div class="line">     <span class="comment">//将str中的字符串复制到value数组中</span></div><div class="line">     str.getChars(<span class="number">0</span>, len, value, count);</div><div class="line">     <span class="comment">//更新当前字符串对象的字符串长度</span></div><div class="line">     count += len;</div><div class="line">     <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="comment">// Documentation in subclasses because of synchro difference</span></div><div class="line"> <span class="function"><span class="keyword">public</span> AbstractStringBuilder <span class="title">append</span><span class="params">(StringBuffer sb)</span> </span>&#123;</div><div class="line">     <span class="keyword">if</span> (sb == <span class="keyword">null</span>)</div><div class="line">         <span class="keyword">return</span> appendNull();</div><div class="line">     <span class="keyword">int</span> len = sb.length();</div><div class="line">     ensureCapacityInternal(count + len);</div><div class="line">     sb.getChars(<span class="number">0</span>, len, value, count);</div><div class="line">     count += len;</div><div class="line">     <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line"> &#125;</div><div class="line"> </div><div class="line"> <span class="function"><span class="keyword">private</span> AbstractStringBuilder <span class="title">appendNull</span><span class="params">()</span> </span>&#123;</div><div class="line">     <span class="keyword">int</span> c = count;</div><div class="line">     ensureCapacityInternal(c + <span class="number">4</span>);</div><div class="line">     <span class="keyword">final</span> <span class="keyword">char</span>[] value = <span class="keyword">this</span>.value;</div><div class="line">     value[c++] = <span class="string">'n'</span>;</div><div class="line">     value[c++] = <span class="string">'u'</span>;</div><div class="line">     value[c++] = <span class="string">'l'</span>;</div><div class="line">     value[c++] = <span class="string">'l'</span>;</div><div class="line">     count = c;</div><div class="line">     <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>从父类中的append方法中我们可以知道主要是使用父类中的<code>ensureCapacityInternal</code>方法进行字符串的追加的，最后返回对象本地身(this),所以append()可以连续调用的，那么继续追踪<code>ensureCapacityInternal</code>源码是怎么实现的:源码如下<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">(<span class="keyword">int</span> minimumCapacity)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (minimumCapacity &gt; <span class="number">0</span>)</div><div class="line">        ensureCapacityInternal(minimumCapacity);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * This method has the same contract as ensureCapacity, but is</div><div class="line"> * never synchronized.</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacityInternal</span><span class="params">(<span class="keyword">int</span> minimumCapacity)</span> </span>&#123;</div><div class="line">    <span class="comment">// overflow-conscious code</span></div><div class="line">    <span class="comment">//如果需要扩展的容量比当前字符数组长度要大。就扩容</span></div><div class="line">    <span class="keyword">if</span> (minimumCapacity - value.length &gt; <span class="number">0</span>)</div><div class="line">        expandCapacity(minimumCapacity);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * This implements the expansion semantics of ensureCapacity with no</div><div class="line"> * size check or synchronization.</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">expandCapacity</span><span class="params">(<span class="keyword">int</span> minimumCapacity)</span> </span>&#123;</div><div class="line"><span class="comment">// 将初始化的新的容量大小为当前字符串长度的2倍 + 2 </span></div><div class="line">    <span class="keyword">int</span> newCapacity = value.length * <span class="number">2</span> + <span class="number">2</span>;</div><div class="line">    <span class="comment">//如果还小的话，那就用最小的容量为新数组的大小</span></div><div class="line">    <span class="keyword">if</span> (newCapacity - minimumCapacity &lt; <span class="number">0</span>)</div><div class="line">        newCapacity = minimumCapacity;</div><div class="line">    <span class="comment">//如果新容量大小或者最小容量小于0</span></div><div class="line">    <span class="comment">//抛出异常并且 设置新容量设置为Integer最能存储的最大值</span></div><div class="line">    <span class="keyword">if</span> (newCapacity &lt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (minimumCapacity &lt; <span class="number">0</span>) <span class="comment">// overflow</span></div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> OutOfMemoryError();</div><div class="line">        newCapacity = Integer.MAX_VALUE;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//创建容量大小为newCapacity的新数组</span></div><div class="line">    value = Arrays.copyOf(value, newCapacity);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>从上面的源码解释中可以看出里面是发生了扩容的，最后将value的值进行拷贝。</p>
<h3 id="delete"><a href="#delete" class="headerlink" title="delete"></a><strong>delete</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> StringBuilder <span class="title">delete</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;  </div><div class="line">    <span class="keyword">super</span>.delete(start, end);  </div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>StringBuffter中主要使用的是父类中方法，看看父类中的delete方法是如何实现的<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 父类AbstractStringBuilder 源码中的delete方法</span></div><div class="line">  <span class="function"><span class="keyword">public</span> AbstractStringBuilder <span class="title">delete</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (start &lt; <span class="number">0</span>)</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(start);</div><div class="line">        <span class="keyword">if</span> (end &gt; count)</div><div class="line">            end = count;</div><div class="line">        <span class="keyword">if</span> (start &gt; end)</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException();</div><div class="line">        <span class="keyword">int</span> len = end - start;</div><div class="line">        <span class="keyword">if</span> (len &gt; <span class="number">0</span>) &#123;</div><div class="line">            System.arraycopy(value, start+len, value, start, count-end);</div><div class="line">            count -= len;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>在父类中的delete中可以看到，方法里面做了数值的常规检查，然后确定需要删除的长度，然后调用系统的数组复制的方法进行复制，最后返回本对象。</p>
<h3 id="subSting"><a href="#subSting" class="headerlink" title="subSting"></a><strong>subSting</strong></h3><p>subString靠父类<code>AbstractStringBuilder</code>实在是太多了。subString也是不例外的，肯定是主要用父类的进行实现了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//StringBuffer的父类源码中的substring中的实现</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">substring</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (start &lt; <span class="number">0</span>)</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(start);</div><div class="line">    <span class="keyword">if</span> (end &gt; count)</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(end);</div><div class="line">    <span class="keyword">if</span> (start &gt; end)</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(end - start);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(value, start, end - start);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>从父类中的方法可以看返回的是一个新的String对象了。与原来的对象是不共享内存的(因为String（char[] ,int, int）是通过<code>this.value = Arrays.copyOfRange(value, offset, offset+count);</code> 使用系统的方法进行拷贝的)。 由于StringBuffer继承于AbstractStringBuilder,所以这个本身不太具有特殊的方法，，这里就不再一一介绍了。</p>
<h1 id="StringBuilder"><a href="#StringBuilder" class="headerlink" title="StringBuilder"></a><strong>StringBuilder</strong></h1><p>之前介绍了String、StringBuffer，那么最后一个StringBuilder怎么能够少了呢？</p>
<h2 id="StringBuilder概述"><a href="#StringBuilder概述" class="headerlink" title="StringBuilder概述"></a><strong>StringBuilder概述</strong></h2><p>StringBuffer是<code>AbstractStringBuilder</code>的子类，StringBuilder也是它的子类。他们的继承和实现的接口都是一样的。<code>AbstractStringBuilder</code>封装了StringBuffer和StringBuilder的大部分操作的实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StringBuilder</span></span></div><div class="line">    <span class="keyword">extends</span> <span class="title">AbstractStringBuilder</span></div><div class="line">    <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">CharSequence</span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringBuilder</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(<span class="number">16</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringBuilder</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(capacity);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringBuilder</span><span class="params">(String str)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(str.length() + <span class="number">16</span>);</div><div class="line">        append(str);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>其中要注意一点是StringBuffer中没有字符缓冲区了，那么在toString()的时候就不是从缓冲区中拿取字符串，的而是重新构造一个String对象出来，内存是不共享的，这个和<code>AbstractStringBuilder</code>中的substring()方法是一样的，都是新创建一个String.</p>
</blockquote>
<p>如下是StringBuilder的toString方法源码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="comment">// Create a copy, don't share the array</span></div><div class="line">       <span class="keyword">return</span> <span class="keyword">new</span> String(value, <span class="number">0</span>, count);</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>还需要注意一点是，StringBuild与StringBuffer不同的是，StringBuild不是线程安全的，其中的方法没有实现同步，但StringBuffer是线程安全的。</p>
</blockquote>
<h1 id="关于String、StringBuffer、StringBuild"><a href="#关于String、StringBuffer、StringBuild" class="headerlink" title="关于String、StringBuffer、StringBuild"></a><strong>关于String、StringBuffer、StringBuild</strong></h1><h2 id="三者的区别"><a href="#三者的区别" class="headerlink" title="三者的区别"></a><strong>三者的区别</strong></h2><p>String 类型和StringBuffer的主要性能区别：String是不可变的对象, 因此在每次对String 类型进行改变的时候，都会生成一个新的 String 对象，然后将指针指向新的 String 对象，所以经常改变内容的字符串最好不要用 String ，因为每次生成对象都会对系统性能产生影响，特别当内存中无引用对象多了以后， JVM 的 GC 就会开始工作，性能就会降低。</p>
<p>使用 StringBuffer 类时，每次都会对 StringBuffer 对象本身进行操作，而不是生成新的对象并改变对象引用。所以多数情况下推荐使用 StringBuffer ，特别是字符串对象经常改变的情况下。</p>
<p>在某些特别情况下， String 对象的字符串拼接其实是被 Java Compiler 编译成了 StringBuffer 对象的拼接，所以这些时候 String 对象的速度并不会比 StringBuffer 对象慢，例如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">String s1 = “This is only a” + “ simple” + “ test”;  </div><div class="line">StringBuffer Sb = <span class="keyword">new</span> StringBuilder(“This is only a”).append(“ simple”).append(“ test”);</div></pre></td></tr></table></figure></p>
<p>生成 String s1对象的速度并不比 StringBuffer慢。其实在Java Compiler里，自动做了如下转换：<br>Java Compiler直接把上述第一条语句编译为:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String s1 = “This is only a simple test”;</div></pre></td></tr></table></figure></p>
<p>所以速度很快。但要注意的是，如果拼接的字符串来自另外的String对象的话，Java Compiler就不会自动转换了，速度也就没那么快了，例如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">String s2 = “This is only a”;  </div><div class="line">String s3 = “ simple”;  </div><div class="line">String s4 = “ test”;  </div><div class="line">String s1 = s2 + s3 + s4;</div></pre></td></tr></table></figure></p>
<p>这时候，Java Compiler会规规矩矩的按照原来的方式去做，String的concatenation（即+）操作利用了StringBuilder（或StringBuffer）的append方法实现，此时，对于上述情况，若s2，s3，s4采用String定义，拼接时需要额外创建一个StringBuffer（或StringBuilder），之后将StringBuffer转换为String；若采用StringBuffer（或StringBuilder），则不需额外创建StringBuffer。</p>
<h2 id="使用策略"><a href="#使用策略" class="headerlink" title="使用策略"></a><strong>使用策略</strong></h2><p> <strong>1. 基本的原则:如果要操作少量的数据，用String；单线程操作大量数据，用StringBuilder多线程操作大量数据用StringBuffer</strong><br>  <strong>2. 尽量不要使用String类的”+”来进行字符串的拼接，因为这样的操作性能是极差的，应该使用StringBuffer和StringBuild</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"> String result = <span class="string">""</span>;  </div><div class="line"><span class="keyword">for</span> (String s : hugeArray) &#123;  </div><div class="line">    result = result + s;  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line"><span class="comment">// 使用StringBuilder  </span></div><div class="line">StringBuilder sb = <span class="keyword">new</span> StringBuilder();  </div><div class="line"><span class="keyword">for</span> (String s : hugeArray) &#123;  </div><div class="line">    sb.append(s);  </div><div class="line">&#125;  </div><div class="line">String result = sb.toString();</div></pre></td></tr></table></figure>
<p><strong>3.为了获得更好的性能，在构造StringBuffer或者StringBuilder时指定它们的容量。如果你操作的字符串的长度不超过16个字符就不用了(默认分配给字符数组大小为16个字符)。</strong></p>
<p><strong>4. StringBuilder一般使用在方法内部来完成类似”+”功能，因为是线程不安全的，所以用完了以后可以丢弃，StringBuffer主要用在全局变量中</strong><br><strong>5. 相同情况下使用StrigBuilder相比使用StringBuffer仅获得10%~15%左右的性能提升，但是却要冒线程不安全的风险，而现实的模块化编程中，负责某一模块的程序员不一定清晰的判断该模块是否会放入多线程的环境中运行，因此:除非确定系统的瓶颈是在StringBuffer上，并且确定你的模块不会运行在多线程模式下，才可以采用StringBuilder；否则还是用StringBUffer</strong></p>
<p>链接：<a href="http://blog.csdn.net/kingzone_2008/article/details/9220691" target="_blank" rel="external">http://blog.csdn.net/kingzone_2008/article/details/9220691</a><br>链接：<a href="http://docs.Oracle.com/javase/tutorial/java/data/buffers.html" target="_blank" rel="external">http://docs.Oracle.com/javase/tutorial/java/data/buffers.html</a><br>链接：<a href="http://docs.oracle.com/javase/specs/jls/se7/html/jls-4.html#jls-4.12.4" target="_blank" rel="external">http://docs.oracle.com/javase/specs/jls/se7/html/jls-4.html#jls-4.12.4</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="http://p7qgi56uk.bkt.clouddn.com/WechatPaysmall.jpg" alt="Charse WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="http://p7qgi56uk.bkt.clouddn.com/Alipaysmall.jpg" alt="Charse Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
            <a href="/tags/Java-Source-Code/" rel="tag"># Java Source Code</a>
          
            <a href="/tags/StringBuilder/" rel="tag"># StringBuilder</a>
          
            <a href="/tags/StringBuffer/" rel="tag"># StringBuffer</a>
          
            <a href="/tags/String/" rel="tag"># String</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/11/05/Hibernate框架——二级缓存(二)/" rel="next" title="Hibernate框架——二级缓存(二)">
                <i class="fa fa-chevron-left"></i> Hibernate框架——二级缓存(二)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/11/08/Java常用类源码——HashMap源码解析/" rel="prev" title="Java常用类源码——HashMap源码解析(JDK1.8)">
                Java常用类源码——HashMap源码解析(JDK1.8) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/11/07/Java常用类源码——String、StringBuffer、StringBuild源码解析/"
           data-title="Java常用类源码——String、StringBuffer、StringBuild源码解析" data-url="http://yoursite.com/2016/11/07/Java常用类源码——String、StringBuffer、StringBuild源码解析/">
      </div>
    
  </div>







        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.png"
               alt="Charse" />
          <p class="site-author-name" itemprop="name">Charse</p>
           
              <p class="site-description motion-element" itemprop="description">Stay hungry, Stay foolish.</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">51</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">35</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Wangchangchung" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/your-user-name" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/5470218610" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.douban.com/people/153537246/" target="_blank" title="豆瓣">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  豆瓣
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/wang-chang-chun-84" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#String"><span class="nav-number">1.</span> <span class="nav-text">String</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#String的定义"><span class="nav-number">1.1.</span> <span class="nav-text">String的定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#构造器"><span class="nav-number">1.2.</span> <span class="nav-text">构造器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#无参数造器"><span class="nav-number">1.2.1.</span> <span class="nav-text">无参数造器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串参数构造器"><span class="nav-number">1.2.2.</span> <span class="nav-text">字符串参数构造器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符数组构造器"><span class="nav-number">1.2.3.</span> <span class="nav-text">字符数组构造器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#第一种"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">第一种</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#字符数组、个数的构造器"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">字符数组、个数的构造器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用字节数组的构造器"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">使用字节数组的构造器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#主要方法"><span class="nav-number">1.3.</span> <span class="nav-text">主要方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#hashCode的实现"><span class="nav-number">1.3.1.</span> <span class="nav-text">hashCode的实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trim"><span class="nav-number">1.3.2.</span> <span class="nav-text">trim()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#intern"><span class="nav-number">1.3.3.</span> <span class="nav-text">intern</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#equals"><span class="nav-number">1.3.4.</span> <span class="nav-text">equals</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#compareTo"><span class="nav-number">1.3.5.</span> <span class="nav-text">compareTo()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#substring"><span class="nav-number">1.3.6.</span> <span class="nav-text">substring()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trim-1"><span class="nav-number">1.3.7.</span> <span class="nav-text">trim()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">1.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#StringBuffer"><span class="nav-number">2.</span> <span class="nav-text">StringBuffer</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#StringBuffer概述"><span class="nav-number">2.1.</span> <span class="nav-text">StringBuffer概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#主要方法-1"><span class="nav-number">2.2.</span> <span class="nav-text">主要方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#append"><span class="nav-number">2.2.1.</span> <span class="nav-text">append</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#delete"><span class="nav-number">2.2.2.</span> <span class="nav-text">delete</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#subSting"><span class="nav-number">2.2.3.</span> <span class="nav-text">subSting</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#StringBuilder"><span class="nav-number">3.</span> <span class="nav-text">StringBuilder</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#StringBuilder概述"><span class="nav-number">3.1.</span> <span class="nav-text">StringBuilder概述</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#关于String、StringBuffer、StringBuild"><span class="nav-number">4.</span> <span class="nav-text">关于String、StringBuffer、StringBuild</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#三者的区别"><span class="nav-number">4.1.</span> <span class="nav-text">三者的区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用策略"><span class="nav-number">4.2.</span> <span class="nav-text">使用策略</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Charse</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"charsewan"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  
















  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("hoyPJdam7ySwVSOa3IpHGgpU-gzGzoHsz", "tSe2gMzMGHhTWXbxL4Cr8bgP");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

</body>
</html>
