<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hibernate框架——对象状态、缓存(二) | Charse Wan&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Hibernate对象的状态应用的场景假设一个班的所有学生要把考试的成绩同步到数据库表中，如果每一个学生和数据库交互一次，那么有60个学生，则需要更数据库交互60次，但是这样的效率是特别的低，那么怎么处理更加高效呢？ 在hibernate中是用什么解决的呢？为了这个问题Hibernate就有了对象状态的这个概念。下面就以我们熟悉的Person表。来进行介绍关于hibernate中对象状态的一些原理">
<meta property="og:type" content="article">
<meta property="og:title" content="Hibernate框架——对象状态、缓存(二)">
<meta property="og:url" content="http://yoursite.com/2016/11/01/Hibernate框架——对象状态(二)/index.html">
<meta property="og:site_name" content="Charse Wan's Blog">
<meta property="og:description" content="Hibernate对象的状态应用的场景假设一个班的所有学生要把考试的成绩同步到数据库表中，如果每一个学生和数据库交互一次，那么有60个学生，则需要更数据库交互60次，但是这样的效率是特别的低，那么怎么处理更加高效呢？ 在hibernate中是用什么解决的呢？为了这个问题Hibernate就有了对象状态的这个概念。下面就以我们熟悉的Person表。来进行介绍关于hibernate中对象状态的一些原理">
<meta property="og:image" content="http://yoursite.com/picture/hibernate2/hibernate_sate.png">
<meta property="og:image" content="http://yoursite.com/picture/hibernate2/copy_state.png">
<meta property="og:image" content="http://yoursite.com/picture/hibernate2/state_change.png">
<meta property="og:image" content="http://yoursite.com/picture/hibernate2/select_same.png">
<meta property="og:image" content="http://yoursite.com/picture/hibernate2/hibernate.session.getSessionSattic.getEnrtyCount.png">
<meta property="og:image" content="http://yoursite.com/picture/hibernate2/hibernateevic.session.getSessionSattic.getEnrtyCount.png">
<meta property="og:image" content="http://yoursite.com/picture/hibernate2/hibernate.flush.png">
<meta property="og:updated_time" content="2016-11-01T10:31:57.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hibernate框架——对象状态、缓存(二)">
<meta name="twitter:description" content="Hibernate对象的状态应用的场景假设一个班的所有学生要把考试的成绩同步到数据库表中，如果每一个学生和数据库交互一次，那么有60个学生，则需要更数据库交互60次，但是这样的效率是特别的低，那么怎么处理更加高效呢？ 在hibernate中是用什么解决的呢？为了这个问题Hibernate就有了对象状态的这个概念。下面就以我们熟悉的Person表。来进行介绍关于hibernate中对象状态的一些原理">
<meta name="twitter:image" content="http://yoursite.com/picture/hibernate2/hibernate_sate.png">
  
    <link rel="alternate" href="/atom.xml" title="Charse Wan&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Charse Wan&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Zoeken"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Hibernate框架——对象状态(二)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/01/Hibernate框架——对象状态(二)/" class="article-date">
  <time datetime="2016-11-01T02:20:09.000Z" itemprop="datePublished">2016-11-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hibernate-Java/">hibernate Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Hibernate框架——对象状态、缓存(二)
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Hibernate对象的状态"><a href="#Hibernate对象的状态" class="headerlink" title="Hibernate对象的状态"></a><strong>Hibernate对象的状态</strong></h2><h3 id="应用的场景"><a href="#应用的场景" class="headerlink" title="应用的场景"></a><strong>应用的场景</strong></h3><p>假设一个班的所有学生要把考试的成绩同步到数据库表中，如果每一个学生和数据库交互一次，那么有60个学生，则需要更数据库交互60次，但是这样的效率是特别的低，那么怎么处理更加高效呢？ 在hibernate中是用什么解决的呢？为了这个问题Hibernate就有了对象状态的这个概念。下面就以我们熟悉的Person表。来进行介绍关于hibernate中对象状态的一些原理。<br><a id="more"></a></p>
<h3 id="对象的状态值"><a href="#对象的状态值" class="headerlink" title="对象的状态值"></a><strong>对象的状态值</strong></h3><p>在Hibernate中，对象的状态主要由以下几种状态：</p>
<ul>
<li>临时状态<br> 刚刚创建的对象</li>
<li>持久状态<br> 经过session.load(),session.get().session.save(),session.update(),方法都是可以把一个对象转变成托管状态。    </li>
<li>脱管状态<br> 经过session.clear(), session.evict().session.cllose(), 方法可以将一个持久化状态转变成托管状态。</li>
</ul>
<h3 id="案例一"><a href="#案例一" class="headerlink" title="案例一"></a><strong>案例一</strong></h3><p>我们的Person对象：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.wcc.hibernate.bean;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.Serializable;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> Long pid;</div><div class="line">	<span class="keyword">private</span> String name;</div><div class="line">	<span class="keyword">private</span> String description;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">getPid</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> pid;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPid</span><span class="params">(Long pid)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.pid = pid;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> name;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.name = name;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> description;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDescription</span><span class="params">(String description)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.description = description;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>HibernateUtils类，用户加载配置文件：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.wcc.hibernate.utils;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</div><div class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuration;</div><div class="line"><span class="comment">/**</span></div><div class="line"> *  Hibernate的一个取得SessionFactory类</div><div class="line"> * <span class="doctag">@author</span> WCC</div><div class="line"> *</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateUtils</span> </span>&#123;</div><div class="line">	</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> SessionFactory sessionFactory;</div><div class="line">	</div><div class="line"><span class="keyword">static</span>&#123;</div><div class="line">	Configuration configuration = <span class="keyword">new</span> Configuration();</div><div class="line">	configuration.configure();</div><div class="line">	sessionFactory = configuration.buildSessionFactory();</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSavePerson</span><span class="params">()</span></span>&#123;</div><div class="line">   Session  session = HibernateUtils.sessionFactory.openSession();</div><div class="line">   Person person = <span class="keyword">new</span> Person();</div><div class="line">   person.setName(<span class="string">"王小虎"</span>);</div><div class="line">   person.setDescription(<span class="string">"好帅"</span>);</div><div class="line">   session.save(person);</div><div class="line">   transaction.commit();</div><div class="line">   session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于上面的这段代码，要进行的操作是将一个记录保存到数据库中，那么进行对象状态的分析，可以得到如下所示的分析图：</p>
<p><img src="/picture/hibernate2/hibernate_sate.png" alt="hiernaet中对象转改的变化分析"></p>
<blockquote>
<p>说明：</p>
<ol>
<li>上图中不步骤1,2,3这三个代码对应的操作时对象的状态称为<strong>临时对象</strong>，其特征是该对象与hibernate没有关系。</li>
<li>当执行第4步的时候，person对象由临时状态转化成<strong>持久化状态，这个时候数据库没有对应的数据，但是该对象在hibernate内部</strong>。</li>
<li>当执行第5步的时候，事务提交了，该对象还是持久化状态的对象，数据库中有对应的值了。</li>
<li>当执行完第6步的时候，session关闭了，该的对象成为<strong>脱管状态</strong>的对象。</li>
</ol>
</blockquote>
<h3 id="案例二"><a href="#案例二" class="headerlink" title="案例二"></a><strong>案例二</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">  只要一个对象是一个持久化转态的对象，</div><div class="line">  当事务提交的时候，hibernate内部自动更新</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetPerson</span><span class="params">()</span></span>&#123;</div><div class="line">    Session  session = HibernateUtils.sessionFactory.openSession();</div><div class="line">    Transaction transaction = session.beginTransaction();</div><div class="line">	<span class="comment">//person为一个持久化转态的对象</span></div><div class="line">    Person person = (Person)session.get(Person.class, <span class="number">1L</span>);</div><div class="line">    perosn.setName(<span class="string">"aaaa"</span>);</div><div class="line">    transaction.commit();</div><div class="line">    session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>说明：<br><strong>1. session.get() 方法提取出来的是一个持久化转态的对象</strong><br><strong>2. 事务提交的时候，hibernate内部自动更新</strong></p>
</blockquote>
<h3 id="案例三"><a href="#案例三" class="headerlink" title="案例三"></a><strong>案例三</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">   对象的副本概念</div><div class="line">*/</div><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetPerson_2</span><span class="params">()</span></span>&#123;</div><div class="line">    Session  session = HibernateUtils.sessionFactory.openSession();</div><div class="line">    Transaction transaction = session.beginTransaction();</div><div class="line">	<span class="comment">// 产生了一个持久化对象，也产生了一个副本</span></div><div class="line">    Person person = (Person)session.get(Person.class, <span class="number">1L</span>);</div><div class="line">	<span class="comment">/* 由于数据库中存储了这条记录，在</span></div><div class="line">    hibernate内部会让person对象对照副本，</div><div class="line">	如果没有变化，则什么都不做，如果发生改变，</div><div class="line">	则发出update语句*/</div><div class="line">    perosn.setName(<span class="string">"aaaa"</span>); </div><div class="line">    transaction.commit();</div><div class="line">    session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>说明：<br><strong>在从数据库中取出的记录在hibernate中保存，并且还有一个副本，hibernate对比副本和原纪录，当没有对记录进行修改的操作，就不会进行update的更新操作，这个的操作虽然增加了内存的消耗，但是所以减少了和数据库的交互，以牺牲内存的代价，换取执行该的效率。</strong></p>
</blockquote>
<p>下面是分析图：<br><img src="/picture/hibernate2/copy_state.png" alt="对象副本"></p>
<h3 id="案例四"><a href="#案例四" class="headerlink" title="案例四"></a><strong>案例四</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdatePerson_2</span><span class="params">()</span></span>&#123;</div><div class="line">     Session  session = HibernateUtils.sessionFactory.openSession();</div><div class="line">     Transaction transaction = session.beginTransaction();</div><div class="line">	 <span class="comment">//持久化转态</span></div><div class="line">     Person person = (Person)session.get(Person.class, <span class="number">1L</span>);</div><div class="line">     perosn.setName(<span class="string">"hello"</span>); </div><div class="line">	 <span class="comment">//把person由持久化转态转变为托管状态</span></div><div class="line">     session.evict(person);</div><div class="line">	 session.update(person);<span class="comment">//持久化状态</span></div><div class="line">     transaction.commit();</div><div class="line">     session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>说明:</p>
<ol>
<li>该例子对象的转态由持久化-&gt;脱管-&gt;持久化</li>
<li><strong>当事务提交的时候，hibernate内部只管持久化状态的对象，对于临时状态和脱管状态是不管的。</strong></li>
</ol>
</blockquote>
<h3 id="对象转化图"><a href="#对象转化图" class="headerlink" title="对象转化图"></a><strong>对象转化图</strong></h3><p><img src="/picture/hibernate2/state_change.png" alt="对象转化图"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h3><ul>
<li>可以通过session.get，session.save，session.update，方法把一个对象变成持久化状态的对象</li>
<li>可以通过session.close   session.evict   session.clear方法把一个对象变成脱管状态的对象</li>
</ul>
<h2 id="Hibernate的缓存"><a href="#Hibernate的缓存" class="headerlink" title="Hibernate的缓存"></a><strong>Hibernate的缓存</strong></h2><h3 id="缓存研究的内容"><a href="#缓存研究的内容" class="headerlink" title="缓存研究的内容"></a><strong>缓存研究的内容</strong></h3><ul>
<li>缓存的生命周期</li>
<li>把一个对象放入到缓存中</li>
<li>把一个对象从缓存中提取出来</li>
<li>把一个对象从缓存中清除</li>
<li>把一些对象从缓存中清除</li>
<li>把缓存中的数据同步到数据库中</li>
<li>把数据库中的数同步到缓存中</li>
</ul>
<h3 id="数据缓存"><a href="#数据缓存" class="headerlink" title="数据缓存"></a><strong>数据缓存</strong></h3><p>数据缓存一般是一个Map<object, object=""> 的集合。</object,></p>
<h3 id="对象缓存"><a href="#对象缓存" class="headerlink" title="对象缓存"></a><strong>对象缓存</strong></h3><p> <strong>1. 对象缓存是一个集合。而不是一个Map</strong><br> <strong>2. 每个对象都是一个唯一的标识符</strong><br> <strong>3. 在Hibernate中，该标识符为主键</strong></p>
<h3 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a><strong>一级缓存</strong></h3><blockquote>
<p>说明</p>
<ol>
<li>一级缓存是session缓存</li>
<li>当session开启的时候，一级缓存起作用，当session关闭的时候，一级缓存销毁了</li>
<li>session 的缓存存放的是私有数据</li>
</ol>
</blockquote>
<h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a><strong>操作</strong></h3><h4 id="将对象放入一级缓存"><a href="#将对象放入一级缓存" class="headerlink" title="将对象放入一级缓存"></a><strong>将对象放入一级缓存</strong></h4><h5 id="get方法"><a href="#get方法" class="headerlink" title="get方法"></a><strong>get方法</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">* 测试 Session.get()方式是否把对象放入到一级缓存中</div><div class="line">*/</div><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetPerson</span><span class="params">()</span></span>&#123;</div><div class="line">   Session  session = HibernateUtils.sessionFactory.openSession();</div><div class="line">   <span class="comment">// 第一次从数据库中查询该记录， 发出 SQL语句</span></div><div class="line">   Person person =(Person) session.get(Person.class,  <span class="number">1L</span>);</div><div class="line">   <span class="comment">//  从数据库中查询相同的记录，不发出SQL语句</span></div><div class="line">   Person person2 = (Person) session.get(Person.class, <span class="number">1L</span>);</div><div class="line">   <span class="comment">//SessionFactoryImpl</span></div><div class="line">   session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>说明： Session.get 方法把一个对象放入到一级缓存中</p>
</blockquote>
<p>下图为上述代码执行后，hibernate执行的SQL语句，从中可以看出，只是对数据库执行了一次的查询操作。<br><img src="/picture/hibernate2/select_same.png" alt="如果查询的是同一个对象，那么就进行一次查询，而不是多次查询"></p>
<h5 id="statictis方法：统计方法"><a href="#statictis方法：统计方法" class="headerlink" title="statictis方法：统计方法"></a><strong>statictis方法：统计方法</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span> </div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStatistics</span><span class="params">()</span></span>&#123;</div><div class="line">   Session session =    HibernateUtils.sessionFactory.openSession();</div><div class="line">   Person person =  (Person) session.get(Person.class, <span class="number">1L</span>);</div><div class="line">   session.get(Person.class, <span class="number">2L</span>);</div><div class="line">   System.out.println(<span class="string">"session.getStatistics().getEntityCount(): "</span> +  session.getStatistics().getEntityCount());</div><div class="line">   session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>说明:  上面的代码中，session的一级缓存中存放了两个对象</p>
</blockquote>
<p>下图中通过统计方法可以知道此时的一级缓存中是有两个对象（从数据库中查询出两个）。</p>
<p><img src="/picture/hibernate2/hibernate.session.getSessionSattic.getEnrtyCount.png" alt="这个是一张统计的图片"></p>
<h5 id="save方法"><a href="#save方法" class="headerlink" title="save方法"></a><strong>save方法</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span></span>&#123;</div><div class="line">   Session session =  HibernateUtils.sessionFactory.openSession();</div><div class="line">   Transaction transaction =  session.beginTransaction();</div><div class="line">   Person  person = <span class="keyword">new</span> Person();</div><div class="line">   person.setName(<span class="string">"张小萌"</span>);</div><div class="line">   person.setDescription(<span class="string">"萌萌哒"</span>);</div><div class="line">   <span class="comment">// 将对象放入一级缓存中</span></div><div class="line">   session.save(person);</div><div class="line">   System.out.println(<span class="string">"session.getStatistics().getEntityCount():"</span> + session.getStatistics().getEntityCount() );</div><div class="line">   transaction.commit();</div><div class="line">   session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>说明: session.save() 方法把对象放入到一级缓存中了</p>
</blockquote>
<h4 id="把一个对象从一级缓存中清除"><a href="#把一个对象从一级缓存中清除" class="headerlink" title="把一个对象从一级缓存中清除"></a><strong>把一个对象从一级缓存中清除</strong></h4><h5 id="evict方法"><a href="#evict方法" class="headerlink" title="evict方法"></a><strong>evict方法</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title">testEvict</span><span class="params">()</span></span>&#123;</div><div class="line">   Session  session = HibernateUtils.sessionFactory.openSession();</div><div class="line">   Person person = (Person) session.get(Person.class, <span class="number">3L</span>);</div><div class="line">   <span class="comment">/**</span></div><div class="line">   * Evict()方法将person对象从一级缓存中清除</div><div class="line">   */</div><div class="line">   session.evict(person);</div><div class="line">   System.out.println(<span class="string">"session.getStatistics().getEntityCount():"</span> + session.getStatistics().getEntityCount() );</div><div class="line">   session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上述代码执行的时候，hibernate输出如下的SQL语句：</p>
<p><img src="/picture/hibernate2/hibernateevic.session.getSessionSattic.getEnrtyCount.png" alt="evict方法"></p>
<p>说明，session调用了evict（）方发法之后，一级缓存中的对象就清楚了。</p>
<h5 id="clear方法"><a href="#clear方法" class="headerlink" title="clear方法"></a><strong>clear方法</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title">testClear</span><span class="params">()</span></span>&#123;</div><div class="line">   Session session  =  HibernateUtils.sessionFactory.openSession();</div><div class="line">   Person  person = (Person) session.get(Person.class, <span class="number">2L</span>);</div><div class="line">   session.get(Person.class, <span class="number">3L</span>);</div><div class="line">   <span class="comment">// 输出 2</span></div><div class="line">   System.out.println(<span class="string">"session.getStatistics().getEntityCount():"</span> + session.getStatistics().getEntityCount());</div><div class="line">session.clear();</div><div class="line">   <span class="comment">// 使用clear()之后将缓存中的对象所有清除掉。</span></div><div class="line">   System.out.println(<span class="string">"session.getStatistics().getEntityCount():"</span> + session.getStatistics().getEntityCount());</div><div class="line">   session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="close方法"><a href="#close方法" class="headerlink" title="close方法"></a><strong>close方法</strong></h5><p>当执行session.close方法的时候，一级缓存的生命更周期结束了。</p>
<h4 id="把数据库的数据同步到缓存中"><a href="#把数据库的数据同步到缓存中" class="headerlink" title="把数据库的数据同步到缓存中"></a><strong>把数据库的数据同步到缓存中</strong></h4><h5 id="refresh方法"><a href="#refresh方法" class="headerlink" title="refresh方法"></a><strong>refresh方法</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title">testRefresh</span><span class="params">()</span></span>&#123;</div><div class="line">   Session session =        HibernateUtils.sessionFactory.openSession();</div><div class="line">   Person person = (Person) session.get(Person.class, <span class="number">1L</span>);</div><div class="line">   person.setName(<span class="string">"张小溪"</span>);</div><div class="line">   System.out.println(person.getName());</div><div class="line">   <span class="comment">//发出SQL语句</span></div><div class="line">   session.refresh(person);</div><div class="line">   <span class="comment">//将出输出数据库中的原有姓名一致</span></div><div class="line">   System.out.println(person.getName());</div><div class="line">   session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="把缓存中的数据同步到数据库中"><a href="#把缓存中的数据同步到数据库中" class="headerlink" title="把缓存中的数据同步到数据库中"></a><strong>把缓存中的数据同步到数据库中</strong></h4><h5 id="flush方法"><a href="#flush方法" class="headerlink" title="flush方法"></a><strong>flush方法</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"> <span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">tesFlush</span><span class="params">()</span></span>&#123;</div><div class="line">   Session session = HibernateUtils.sessionFactory.openSession();</div><div class="line">   Transaction transaction = session.beginTransaction();</div><div class="line">   Person person = <span class="keyword">new</span> Person();</div><div class="line">   person.setName(<span class="string">"李小天"</span>);</div><div class="line">   <span class="comment">// 持久化</span></div><div class="line">   Person person2 = (Person) session.get(Person.class, <span class="number">1L</span>);</div><div class="line">   person2.setName(<span class="string">"hello"</span>);</div><div class="line">   <span class="comment">// 持久化</span></div><div class="line">   Person person3 = (Person)session.get(Person.class, <span class="number">2L</span>);</div><div class="line">   <span class="comment">// 临时状态转化为持久化状态</span></div><div class="line">   session.save(person);</div><div class="line">   session.flush();</div><div class="line">   transaction.commit();</div><div class="line">   session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>说明：<br> <strong>当执行flush() 方法的时候，Hibernate会检查一级缓存中所有的持久化转态的对象，如果该持久化状态的对象没有标识符的值，则会发出insert语句，如果该持久化状态的对象有标识符的值，则会对照副本，看是否和副本一致，如果一致，则什么都不做，如果不一致，则发出update语句</strong></p>
</blockquote>
<p>执行上述代码的时候hibernate执行如下的SQL语句：<br><img src="/picture/hibernate2/hibernate.flush.png" alt="hibernate执行flush"></p>
<h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a><strong>总结</strong></h4><blockquote>
<p><strong>一级缓存提供了一个临时存放对象的一个内存结构，当Hibernate对对象进行操作的时候，仅仅改变的是对象的属性，改变的是一级缓存中的对象的属性，在seeesion.flush之前的代码可以任意写，因为这个时候，并没有和数据库交互。当执行session.flush的时候，Hibernate会检查一级缓存中的对象的情况，发出insert或者update语句。</strong></p>
</blockquote>
<h2 id="Session的产生方式"><a href="#Session的产生方式" class="headerlink" title="Session的产生方式"></a><strong>Session的产生方式</strong></h2><h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a><strong>需求</strong></h3><p>转账的需求：后台有一张表：account表(aid, account,money), 操作将account为1的账号转移100元到account2中。<br><strong>实现：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">reduceMoney</span><span class="params">(String account)</span></span>&#123;</div><div class="line">   Session session = sessionFactory.openSession();</div><div class="line">   Transaction transaction = session.beginTransaction();</div><div class="line">   Account account2 = (Account)session.createQuery(<span class="string">"from Account where account='"</span>+account+<span class="string">"'"</span>)</div><div class="line">				.uniqueResult();</div><div class="line">   account2.setMoney(account2.getMoney()-<span class="number">100</span>);</div><div class="line">   transaction.commit();</div><div class="line">   session.close();</div><div class="line">&#125;</div><div class="line">	</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addMoney</span><span class="params">(String account)</span></span>&#123;</div><div class="line">   Session session = sessionFactory.openSession();</div><div class="line">   Transaction transaction = session.beginTransaction();</div><div class="line">   Account account2 = (Account)session.createQuery(<span class="string">"from Account where account='"</span>+account+<span class="string">"'"</span>)</div><div class="line">				.uniqueResult();</div><div class="line">   account2.setMoney(account2.getMoney()+<span class="number">100</span>);</div><div class="line">   transaction.commit();</div><div class="line">   session.close();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTrform</span><span class="params">()</span></span>&#123;</div><div class="line">   AccountDao accountDao = <span class="keyword">new</span> AccountDao();</div><div class="line">   accountDao.addMoney(<span class="string">"1"</span>);</div><div class="line">   <span class="keyword">int</span> a = <span class="number">1</span>/<span class="number">0</span>;</div><div class="line">   accountDao.reduceMoney(<span class="string">"2"</span>); </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>说明：<strong> 这样的写法是不对的，因为在这两个方法中开启了两个session，如果在程序的执行过程中遇到了异常，就有可能出现转账的错误。所以这样的写法是满足不了这种情况的。</strong></p>
</blockquote>
<h3 id="sessionFaactory-openSession"><a href="#sessionFaactory-openSession" class="headerlink" title="sessionFaactory.openSession"></a><strong>sessionFaactory.openSession</strong></h3><p>每一次执行openSession 的时候会打开一个session ，效率比较低。</p>
<h3 id="sessionFactory-getCurrentSession"><a href="#sessionFactory-getCurrentSession" class="headerlink" title="sessionFactory.getCurrentSession"></a><strong>sessionFactory.getCurrentSession</strong></h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a><strong>原理</strong></h4><p> <strong>1. 从当前线程中(ThreadLocal)中，把session提取出来</strong><br> <strong>2. 如果当前线程中没有session(第一步失败提取失败)，则调用openSession方法创建一个session</strong><br> <strong>3. 接着第二步，把session放入到threadlocal中。</strong><br> <strong>4. 再执行第一步的步骤。</strong></p>
<h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a><strong>优点</strong></h4><p><em>不管有几个类完全松耦合，如果这几个类要用到同一个session，在运行的时候，如果这几个类在同一个线程下运行，利用threadlocal就能够保证是同一个session。</em></p>
<h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a><strong>步骤</strong></h4><h5 id="在Hibernate-cfg-xml文件中"><a href="#在Hibernate-cfg-xml文件中" class="headerlink" title="在Hibernate.cfg.xml文件中"></a><strong>在Hibernate.cfg.xml文件中</strong></h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"current_session_cntext_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure>
<h5 id="在客户端"><a href="#在客户端" class="headerlink" title="在客户端"></a><strong>在客户端</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Session session = sessionFactory.getCurrentSession();</div><div class="line">Transacction transaction = session.getCurrentSession();</div><div class="line">Account account = (Account)session.get(Account.class, <span class="number">1L</span>);</div><div class="line">transaction.comit();</div></pre></td></tr></table></figure>
<blockquote>
<p>说明：<br><strong>1. CRUD操作必须在事务的环境下运行(所以，上述的代码中，必须有session.beginTransaction())。</strong><br><strong>2. 事务提交，session自动关闭（如果手动再session.close()则会报出“session已经关闭的错误”）。</strong><br><strong>3. 这种方式强制把事务和session绑定在一起了。</strong></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/01/Hibernate框架——对象状态(二)/" data-id="civ4ygwhi000uzwcnm5nkdvgz" class="article-share-link">Delen</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hibernate/">hibernate</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/11/04/hibernate框架——关系操作(三)/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Nieuwer</strong>
      <div class="article-nav-title">
        
          hibernate框架——关系操作(三)
        
      </div>
    </a>
  
  
    <a href="/2016/10/05/Hibernate框架——基本操作(一)/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Ouder</strong>
      <div class="article-nav-title">Hibernate框架——基本操作(一)</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categorieën</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP-前端-后端/">HTTP 前端 后端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hibernate-Java/">Hibernate Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JVM-Java/">JVM, Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hibernate-Java/">hibernate Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/">数据结构</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Labels</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CheckBox/">CheckBox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Class字节码/">Class字节码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hibernate/">Hibernate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HotSpot垃圾收集算法/">HotSpot垃圾收集算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java内存区域/">Java内存区域</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java垃圾回收机制/">Java垃圾回收机制</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hibernate/">hibernate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/内存回收/">内存回收</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端/">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/后端/">后端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/垃圾收集算法/">垃圾收集算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/程序/">程序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/索引/">索引</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 10px;">Android</a> <a href="/tags/CheckBox/" style="font-size: 10px;">CheckBox</a> <a href="/tags/Class字节码/" style="font-size: 10px;">Class字节码</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Hibernate/" style="font-size: 10px;">Hibernate</a> <a href="/tags/HotSpot垃圾收集算法/" style="font-size: 10px;">HotSpot垃圾收集算法</a> <a href="/tags/JVM/" style="font-size: 16.67px;">JVM</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Java内存区域/" style="font-size: 10px;">Java内存区域</a> <a href="/tags/Java垃圾回收机制/" style="font-size: 10px;">Java垃圾回收机制</a> <a href="/tags/MySQL/" style="font-size: 13.33px;">MySQL</a> <a href="/tags/hibernate/" style="font-size: 16.67px;">hibernate</a> <a href="/tags/内存回收/" style="font-size: 10px;">内存回收</a> <a href="/tags/前端/" style="font-size: 10px;">前端</a> <a href="/tags/后端/" style="font-size: 10px;">后端</a> <a href="/tags/垃圾收集算法/" style="font-size: 10px;">垃圾收集算法</a> <a href="/tags/数据库/" style="font-size: 16.67px;">数据库</a> <a href="/tags/数据结构/" style="font-size: 10px;">数据结构</a> <a href="/tags/程序/" style="font-size: 10px;">程序</a> <a href="/tags/索引/" style="font-size: 10px;">索引</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archieven</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recente berichten</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/11/05/Hibernate框架——二级缓存、Hql语句(四)/">Hibernate框架——二级缓存、Hql语句</a>
          </li>
        
          <li>
            <a href="/2016/11/04/hibernate框架——关系操作(三)/">hibernate框架——关系操作(三)</a>
          </li>
        
          <li>
            <a href="/2016/11/01/Hibernate框架——对象状态(二)/">Hibernate框架——对象状态、缓存(二)</a>
          </li>
        
          <li>
            <a href="/2016/10/05/Hibernate框架——基本操作(一)/">Hibernate框架——基本操作(一)</a>
          </li>
        
          <li>
            <a href="/2016/10/02/高性能场景下-HashMap的优化使用建议/">高性能场景下,HashMap的优化使用建议</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Charse Wang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>