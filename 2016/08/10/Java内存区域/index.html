<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Java内存区域 | Charse Wan&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="1. 概述对C、C++程序开发人员来说，在内存管理方面，是比较头疼的，他们既是拥有最高权力的”皇帝”，又是从事最基础工作的”劳动人民”——既拥有每一个对象的”所有权”，又担负着每一个对象生命从开始到终结的维护责任。
对于Java程序员来说，在虚拟机自动的内存管理机制的帮助下，不用再为内存额分配与回收而操心了，但是，把内存的控制权交给Java虚拟机后，一旦出现内存溢出和泄漏的问题，我们如果不知道如何">
<meta property="og:type" content="article">
<meta property="og:title" content="Java内存区域">
<meta property="og:url" content="http://yoursite.com/2016/08/10/Java内存区域/index.html">
<meta property="og:site_name" content="Charse Wan's Blog">
<meta property="og:description" content="1. 概述对C、C++程序开发人员来说，在内存管理方面，是比较头疼的，他们既是拥有最高权力的”皇帝”，又是从事最基础工作的”劳动人民”——既拥有每一个对象的”所有权”，又担负着每一个对象生命从开始到终结的维护责任。
对于Java程序员来说，在虚拟机自动的内存管理机制的帮助下，不用再为内存额分配与回收而操心了，但是，把内存的控制权交给Java虚拟机后，一旦出现内存溢出和泄漏的问题，我们如果不知道如何">
<meta property="og:image" content="http://yoursite.com/picture/JVM_Run_Data_Area.png">
<meta property="og:updated_time" content="2016-08-21T00:21:10.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java内存区域">
<meta name="twitter:description" content="1. 概述对C、C++程序开发人员来说，在内存管理方面，是比较头疼的，他们既是拥有最高权力的”皇帝”，又是从事最基础工作的”劳动人民”——既拥有每一个对象的”所有权”，又担负着每一个对象生命从开始到终结的维护责任。
对于Java程序员来说，在虚拟机自动的内存管理机制的帮助下，不用再为内存额分配与回收而操心了，但是，把内存的控制权交给Java虚拟机后，一旦出现内存溢出和泄漏的问题，我们如果不知道如何">
<meta name="twitter:image" content="http://yoursite.com/picture/JVM_Run_Data_Area.png">
  
    <link rel="alternate" href="/atom.xml" title="Charse Wan&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Charse Wan&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Zoeken"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Java内存区域" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/10/Java内存区域/" class="article-date">
  <time datetime="2016-08-10T00:14:06.000Z" itemprop="datePublished">2016-08-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JVM-Java/">JVM, Java</a>
  </div>

  </div>
  <div class="article-inner">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="/picture/JVM_Run_Data_Area.png" rel="gallery_civ4ygwhy0016zwcn0coubo0i">
        <img src="/picture/JVM_Run_Data_Area.png" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Java内存区域
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a><strong>1. 概述</strong></h3><p>对C、C++程序开发人员来说，在内存管理方面，是比较头疼的，他们既是拥有最高权力的”皇帝”，又是从事最基础工作的”劳动人民”——既拥有每一个对象的”所有权”，又担负着每一个对象生命从开始到终结的维护责任。</p>
<p>对于Java程序员来说，在虚拟机自动的内存管理机制的帮助下，不用再为内存额分配与回收而操心了，但是，把内存的控制权交给Java虚拟机后，一旦出现内存溢出和泄漏的问题，我们如果不知道如何了解虚拟机怎么使用内存，那么排查错误将会成为一项异常艰难的工作。<br><a id="more"></a></p>
<h3 id="2-运行时数据区域"><a href="#2-运行时数据区域" class="headerlink" title="2. 运行时数据区域"></a><strong>2. 运行时数据区域</strong></h3><p>Java 虚拟机在执行 Java 程序的过程中会把它所有的内存划分为若干个不同的数据区域，这些区域都有各自的用途，以及创建和销毁的时间，有的区域随着虚拟机进程的启动而存在，有些区域则依赖用户线程的启动和结束而建立和销毁。</p>
<p>Java虚拟机所管理的内存区域包含以下的几个数据区域:<br><img src="/picture/JVM_Run_Data_Area.png" alt="Java虚拟机运行时数据区"></p>
<h4 id="2-1-程序计数器"><a href="#2-1-程序计数器" class="headerlink" title="2.1 程序计数器"></a><strong>2.1 程序计数器</strong></h4><p><strong>程序计数器是一块比较小的内存空间，它可以看作是当前程序所执行的字节码的行号指示器。</strong>字节码解释器工作时就是通过改变这个计数器的值来选取下一条需要执行的字节码指令，分支、循环、跳转、异常处理、线程恢复等基础功能都需要依赖这个计数器来完成。</p>
<p><strong>由于Java虚拟机的多线程是通过线程轮流切换并分配处理器执行时间的方式来实现的，在任何一个确定的时刻，一个处理器(对于多核处理器来说是一个内核)都只会执行一条线程中的指令，因此，为了线程切换之后能够恢复到正确的执行位置，每条线程需要有一个独立的程序计数器，各个线程之间计数器互不影响，独立存储，我们称这类内存区域为”线程私有”的内存。</strong></p>
<p>如果线程正在执行的是一个Java方法，这个计数器记录的是正在执行的虚拟机字节码指令地址；如果正在执行的是Native方法，这个计数器值则为空(Undefined)。此内存区域是唯一一个在Java虚拟机规范中没有规定任何(OutOfMemoryError)情况的区域。</p>
<h4 id="2-2-Java虚拟机栈"><a href="#2-2-Java虚拟机栈" class="headerlink" title="2.2 Java虚拟机栈"></a><strong>2.2 Java虚拟机栈</strong></h4><p><strong>与程序计数器一样，Java虚拟机栈(Java Virtual Machine Stacks)也是线程私有的，它的生命周期与线程相同。</strong>虚拟机栈描述的是Java 方法执行的内存模型:每个方法在执行的同时都会创建一个栈帧(Stack Frame)用于存储局部变量表、操作数栈、动态链接、方法出口等信息。每一个方法出口从调用直至执行完成的过程，就对应着一个栈帧在虚拟机栈中入栈到出栈的过程。</p>
<p>通常有人喜欢把Java内存区域分为堆内存(Heap)和栈内存(Statck),这中分法是比较粗糙的，实际上Java的内存区域的划分远比这个复杂。这种分法只能说明大多数程序员最关注的、与对象内存分配关系最密切的内存区域是这两块。这里的”栈”就是讲的Java虚拟机栈，或者说是虚拟机栈中局部变量表部分。<br>局部变量表存放了编译期可知的各种基本数据类型(boolean、byte、char、short、int、float、long、double)、对象引用(reference 类型，它不等同于对象本身，可能是一个指向对象起始地址的引用指针，也可能是一个代表对象的句柄或者其他与此对象相关的位置)和 returnAddress 类型(指向了一条字节码指令的地址)</p>
<p>其中64位长度的 long 和 double 类型的数据会占用2个局部变量空间( Slot )，其余的数据类型只占用 1个。局部变量表所需要的内存空间在编译期间完成分配，当进入一个方法时，这个方法只需要在帧中分配多大的局部变量空间是完全确定的，在方法运行期间不会改变局部变量表的大小。</p>
<p>####<strong>2.3 本地方法栈</strong></p>
<p>本地方法栈( Native Method Stack )与虚拟机栈所发挥的作用是非常相似的，他们之间的区别不过是虚拟机栈为虚拟机执行Java方法(也就是字节码)服务，而本地方法栈则是为虚拟机使用到的Native方法服务。在虚拟机规范中对本地方法栈中方法使用的语言、使用方式与数据结构并没有强制规定，因此具体的虚拟机可以自由实现它，甚至有的虚拟机(比如： Sun HotSpot虚拟机)直接就把本地方法栈和虚拟机栈合二位一。</p>
<h4 id="2-4-Java堆"><a href="#2-4-Java堆" class="headerlink" title="2.4 Java堆"></a><strong>2.4 Java堆</strong></h4><p>Java 堆(Java Heap)是Java虚拟机所管理的内存中最大的一块。<strong>Java堆是被所有线程共享的一块内存区域，在虚拟机启动的时候创建。此内存区域的唯一目的就是存放对象实例，几乎所有的对象实例都在这里分配内存。</strong>这一点在Java虚拟机规范中的描述是：所有的对象实例以及数组都要在堆上分配，但是随着JIT编译器的发展与逃逸分析技术逐渐成熟，栈上分配、标量替换优化技术将会导致一些微妙的变化发生，所有对象都分配在堆上也变的不是那么的绝对了。</p>
<p><strong>Java堆是垃圾收集器管理的主要区域，所以也被称为”GC堆”。从内存回收的角度，由于现在的收集器基本都是采用分代收集算法，所以Java堆中还可以细分为:新生代和老年代；再细致一点的有Eden空间、From Survivor 空间、To Survivor 空间等。</strong>从内存分配的角度来看，线程共享的Java堆中可能划分出多个线程私有的分配缓冲区(Thread Loacl Allocation Buffer，TLAB)。无论如何划分，都与存放的内容无关，无论哪个区域，存储的都仍然是对象实例，进一步划分的目的是为了更好的回收内存，或者更快的分配内存。</p>
<h4 id="2-5-方法区"><a href="#2-5-方法区" class="headerlink" title="2.5 方法区"></a><strong>2.5 方法区</strong></h4><p><strong>方法区(Method Area)与Java堆一样，是各个线程共享的内存区域，它用于存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据。</strong>虽然Java虚拟机规范把方法区描述为堆的一个逻辑部分，但是它却有一个别名叫做Non-Heap(非堆)，目的应该是与Java堆区分开来。</p>
<p>对于习惯在HotSpot虚拟机上开发、部署应用的开发者来说，很多人更愿意把方法区称为”永久代”(Permanent Generation)，本质上两者并等价，仅仅是因为HotSpot虚拟机的设计团队选择把GC分代收集扩展至方法区，或者说使用永久代来实现方法区而已，这样HotSpot的垃圾收集器可以像管理Java堆一样管理这部分内存，能够省去专门为方法区编写内存管理代码的工作。对于其他虚拟机(如：BEA JRockit、IBM J9等)来说是不存在永久代的概念。如何实现方法区是属于虚拟机的实现细节，不受虚拟机规范约束。</p>
<p><strong>Java虚拟机规范对方法区的限制非常宽松，除了和Java堆一样不需要连续的内存和可以选择固定大小或者可扩展外，还可以选择不实现垃圾收集。</strong>相对而言，垃圾收集行为在这个区域出现的比较少，但是并非数据进入了方法区就如通过永久代的名字一样”永久”存在了。这个区域的内存回收目标主要是针对常量池的回收和对类型的卸载，一般来说，这个区域的回收”成绩”比较难以令人满意，尤其是类型的卸载，条件相当苛刻，但是这部分区域的回收确实是必要的。</p>
<h4 id="2-6-运行时常量池"><a href="#2-6-运行时常量池" class="headerlink" title="2.6 运行时常量池"></a><strong>2.6 运行时常量池</strong></h4><p><strong>运行时常量池( Runtime Constant Pool )是方法区的一部分，Class文件中除了有类的版本、字段、方法、接口等描述信息外，还有一项信息是常量池( Constant Pool Table )，用于存放编译期生成的各种字面量和符号引用，这部分内容将在类加载后进入方法区的运行时常量池中存放。</strong></p>
<p>Java虚拟机对Class文件每一部分( 自然也包括常量池 )的格式都有严格规定，每一个字节用于存储那种数据都必须符合规范上的要求才会被虚拟机认可、装载和执行，但是对于运行时常量池，Java虚拟机规范没有做任何细节的要求，不同的提供商实现的虚拟机可以按照自己的需要来实现这个内存区域，不过，一般来说，除了保存Class文件中描述的符号引用外，还会把翻译出来的直接引用也存储在运行时常量池中。</p>
<p>运行时常量池相对于Class文件常量池的另一个重要特征是具备动态性，Java语言并不要求常量一定只有编译期才能产生，也就是并非预置入Clas 文件中常量池的内容才能进入方法区运行时常量池，运行期间也可能将新的常量放入池中，这种特性被开发人员利用的比较多的便是String类的intern( ) 方法。</p>
<h4 id="2-7-直接内存"><a href="#2-7-直接内存" class="headerlink" title="2.7 直接内存"></a><strong>2.7 直接内存</strong></h4><p>直接内存(Direct Memory)并不是虚拟机运行时数据区的一部分，也不是Java虚拟机规范中定义的内存区域，但是这部分内存也被频繁的使用，而且也可能导致OutOfMemoryError异常出现。</p>
<p>在 JDK 1.4 中新加入了NIO( New Input/Output)类，引入了一种基于通道( Channel )与缓冲区( Buffer )的I/O方式，它可以使用 Native 函数库直接分配堆外内存，然后通过一个存储在Java堆中的DirectBuffer对象作为这块内存的引用进行操作。这样能在一些场景中显著提高性能，因为避免了在 Java 堆和 Native 堆中来回复制数据。</p>
<p>显然，本机直接内存的分配不会受到 Java 堆大小的限制，但是既然是内存，肯定还是会受到本机总内存(包括 RAM 以及 SWAP 区或者分页文件)大小以及处理器寻址空间的限制。服务器管理员在配置虚拟机参数时，会根据实际内存设置 -Xmx 等参数信息，但经常忽略直接内存，使得各个内存区域总和大于物理内存限制(包括物理的和操作系统级的限制)，从而导致动态拓展的时候出现 OutOfMemoryError 异常。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/08/10/Java内存区域/" data-id="civ4ygwhy0016zwcn0coubo0i" class="article-share-link">Delen</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JVM/">JVM</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java内存区域/">Java内存区域</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/08/14/Java的垃圾收集机制/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Nieuwer</strong>
      <div class="article-nav-title">
        
          Java的垃圾收集机制
        
      </div>
    </a>
  
  
    <a href="/2016/08/09/字节码文件-Java虚拟机的平台无关性/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Ouder</strong>
      <div class="article-nav-title">字节码文件--Java虚拟机的平台无关性</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categorieën</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP-前端-后端/">HTTP 前端 后端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hibernate-Java/">Hibernate Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JVM-Java/">JVM, Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hibernate-Java/">hibernate Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/">数据结构</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Labels</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CheckBox/">CheckBox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Class字节码/">Class字节码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hibernate/">Hibernate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HotSpot垃圾收集算法/">HotSpot垃圾收集算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java内存区域/">Java内存区域</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java垃圾回收机制/">Java垃圾回收机制</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hibernate/">hibernate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/内存回收/">内存回收</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端/">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/后端/">后端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/垃圾收集算法/">垃圾收集算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/程序/">程序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/索引/">索引</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 10px;">Android</a> <a href="/tags/CheckBox/" style="font-size: 10px;">CheckBox</a> <a href="/tags/Class字节码/" style="font-size: 10px;">Class字节码</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Hibernate/" style="font-size: 10px;">Hibernate</a> <a href="/tags/HotSpot垃圾收集算法/" style="font-size: 10px;">HotSpot垃圾收集算法</a> <a href="/tags/JVM/" style="font-size: 16.67px;">JVM</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Java内存区域/" style="font-size: 10px;">Java内存区域</a> <a href="/tags/Java垃圾回收机制/" style="font-size: 10px;">Java垃圾回收机制</a> <a href="/tags/MySQL/" style="font-size: 13.33px;">MySQL</a> <a href="/tags/hibernate/" style="font-size: 16.67px;">hibernate</a> <a href="/tags/内存回收/" style="font-size: 10px;">内存回收</a> <a href="/tags/前端/" style="font-size: 10px;">前端</a> <a href="/tags/后端/" style="font-size: 10px;">后端</a> <a href="/tags/垃圾收集算法/" style="font-size: 10px;">垃圾收集算法</a> <a href="/tags/数据库/" style="font-size: 16.67px;">数据库</a> <a href="/tags/数据结构/" style="font-size: 10px;">数据结构</a> <a href="/tags/程序/" style="font-size: 10px;">程序</a> <a href="/tags/索引/" style="font-size: 10px;">索引</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archieven</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recente berichten</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/11/05/Hibernate框架——二级缓存、Hql语句(四)/">Hibernate框架——二级缓存、Hql语句</a>
          </li>
        
          <li>
            <a href="/2016/11/04/hibernate框架——关系操作(三)/">hibernate框架——关系操作(三)</a>
          </li>
        
          <li>
            <a href="/2016/11/01/Hibernate框架——对象状态(二)/">Hibernate框架——对象状态、缓存(二)</a>
          </li>
        
          <li>
            <a href="/2016/10/05/Hibernate框架——基本操作(一)/">Hibernate框架——基本操作(一)</a>
          </li>
        
          <li>
            <a href="/2016/10/02/高性能场景下-HashMap的优化使用建议/">高性能场景下,HashMap的优化使用建议</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Charse Wang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>